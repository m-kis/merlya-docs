{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"],"fields":{"title":{"boost":1000.0},"text":{"boost":1.0},"tags":{"boost":1000000.0}}},"docs":[{"location":"","title":"Merlya","text":"<p>AI-powered infrastructure assistant for DevOps and SRE teams.</p> <p>Merlya is a command-line tool that combines the power of large language models with practical infrastructure management capabilities. It helps you manage SSH connections, execute commands across multiple servers, and automate routine tasks using natural language.</p>"},{"location":"#key-features","title":"Key Features","text":"<ul> <li> <p> Natural Language Interface</p> <p>Interact with your infrastructure using plain English. No need to memorize complex command syntax.</p> </li> <li> <p> SSH Management</p> <p>Connect to servers, execute commands, and manage connections with built-in pooling and retry logic.</p> </li> <li> <p> Multiple LLM Providers</p> <p>Support for OpenAI, Anthropic, Ollama, and more. Use cloud or local models.</p> </li> <li> <p> Secure by Design</p> <p>Credentials stored in system keyring. No secrets in config files.</p> </li> </ul>"},{"location":"#quick-example","title":"Quick Example","text":"<pre><code># Install Merlya\npip install merlya\n\n# Configure your LLM provider\nmerlya config set llm.provider openai\nmerlya config set llm.api_key sk-...\n\n# Start interactive mode\nmerlya\n\n# Or run a single command\nmerlya run \"Check disk space on all servers\"\n</code></pre> <pre><code>You: Connect to my web server and check disk usage\nMerlya: I'll connect to web-server-01 and check the disk usage.\n\n&gt; ssh web-server-01 \"df -h\"\n\nFilesystem      Size  Used Avail Use% Mounted on\n/dev/sda1       100G   45G   55G  45% /\n\nThe disk usage is at 45%. You have 55GB available.\n</code></pre>"},{"location":"#why-merlya","title":"Why Merlya?","text":"<ul> <li>Speed: Execute complex operations with simple commands</li> <li>Safety: Review commands before execution, secure credential storage</li> <li>Flexibility: Works with any LLM provider, local or cloud</li> <li>Extensibility: Plugin system for custom tools and integrations</li> </ul>"},{"location":"#getting-started","title":"Getting Started","text":"<p>Ready to get started? Check out the Installation Guide to set up Merlya in minutes.</p> <p>Get Started  View on GitHub </p>"},{"location":"architecture/decisions/","title":"Architecture Decisions","text":"<p>Key architectural decisions and their rationale.</p>"},{"location":"architecture/decisions/#overview","title":"Overview","text":"<p>Merlya is built on a modular architecture designed for extensibility, security, and ease of use.</p> <pre><code>graph TB\n    subgraph \"User Interface\"\n        CLI[CLI / REPL]\n    end\n\n    subgraph \"Core\"\n        Router[Intent Router]\n        Context[Context Manager]\n        Agent[PydanticAI Agent]\n    end\n\n    subgraph \"Tools\"\n        SSH[SSH Tools]\n        System[System Tools]\n        Security[Security Tools]\n    end\n\n    subgraph \"Providers\"\n        OpenAI[OpenAI]\n        Anthropic[Anthropic]\n        Ollama[Ollama]\n    end\n\n    CLI --&gt; Router\n    Router --&gt; Agent\n    Agent --&gt; Context\n    Agent --&gt; SSH\n    Agent --&gt; System\n    Agent --&gt; Security\n    Agent --&gt; OpenAI\n    Agent --&gt; Anthropic\n    Agent --&gt; Ollama</code></pre>"},{"location":"architecture/decisions/#adr-001-pydanticai-for-agent-framework","title":"ADR-001: PydanticAI for Agent Framework","text":"<p>Status: Accepted</p> <p>Context: We needed a framework for building LLM-powered agents with tool calling capabilities.</p> <p>Decision: Use PydanticAI as the agent framework.</p> <p>Rationale: - Type-safe with Pydantic models - Native async support - Clean tool definition API - Multi-provider support - Active development and community</p> <p>Consequences: - Dependency on PydanticAI - Benefits from upstream improvements - May need to adapt to API changes</p>"},{"location":"architecture/decisions/#adr-002-asyncssh-for-ssh-connections","title":"ADR-002: AsyncSSH for SSH Connections","text":"<p>Status: Accepted</p> <p>Context: SSH connectivity is core to Merlya's functionality.</p> <p>Decision: Use asyncssh for all SSH operations.</p> <p>Rationale: - Pure Python, no external dependencies - Async-native for concurrent connections - Full SSH2 protocol support - Jump host support built-in - Active maintenance</p> <p>Consequences: - Async-only API - Connection pooling needed for performance - Memory overhead for many connections</p>"},{"location":"architecture/decisions/#adr-003-connection-pooling","title":"ADR-003: Connection Pooling","text":"<p>Status: Accepted</p> <p>Context: Frequent SSH connections are slow and resource-intensive.</p> <p>Decision: Implement connection pooling with automatic cleanup.</p> <p>Rationale: - Avoid connection overhead for repeated commands - Limit concurrent connections - Automatic cleanup of idle connections - Graceful shutdown handling</p> <p>Implementation: <pre><code>class SSHPool:\n    max_connections: int = 10\n    idle_timeout: int = 300  # 5 minutes\n\n    async def get_connection(host) -&gt; SSHConnection\n    async def release_connection(conn)\n    async def cleanup_idle()\n</code></pre></p>"},{"location":"architecture/decisions/#adr-004-keyring-for-credential-storage","title":"ADR-004: Keyring for Credential Storage","text":"<p>Status: Accepted</p> <p>Context: API keys and credentials need secure storage.</p> <p>Decision: Use the system keyring (via <code>keyring</code> library).</p> <p>Rationale: - OS-level security (Keychain, Secret Service, Credential Manager) - No plaintext secrets in config files - Standard cross-platform solution - Fallback to in-memory with warning</p> <p>Consequences: - Requires keyring backend on Linux - May need user interaction for first-time setup - Headless servers need alternative setup</p>"},{"location":"architecture/decisions/#adr-005-local-intent-classification","title":"ADR-005: Local Intent Classification","text":"<p>Status: Accepted</p> <p>Context: Not all user inputs require LLM processing.</p> <p>Decision: Use ONNX-based local classifier for intent routing.</p> <p>Rationale: - Fast (&lt; 10ms) classification - No API calls for simple intents - Works offline - Reduces API costs</p> <p>Implementation: <pre><code>User Input \u2192 Intent Classifier \u2192 [Simple Intent] \u2192 Direct Handler\n                              \u2192 [Complex Intent] \u2192 LLM Agent\n</code></pre></p> <p>Consequences: - Additional model file (~50MB) - Needs training data for new intents - May misclassify edge cases</p>"},{"location":"architecture/decisions/#adr-006-yaml-configuration-with-sqlite-storage","title":"ADR-006: YAML Configuration with SQLite Storage","text":"<p>Status: Accepted</p> <p>Context: Configuration needs to be human-readable and editable. Host inventory requires structured storage with querying capabilities.</p> <p>Decision: Use YAML for configuration files and SQLite for host inventory.</p> <p>Rationale: - YAML: Human-friendly syntax, widely used in DevOps - YAML: Native support for complex structures - SQLite: Fast querying for host lookups - SQLite: Supports tagging, filtering, and search - SQLite: Single file, no server needed</p> <p>File Locations: - <code>~/.merlya/config.yaml</code> - Main configuration - <code>~/.merlya/merlya.db</code> - Host inventory (SQLite) - <code>~/.merlya/logs/</code> - Log files - <code>~/.merlya/history</code> - Command history</p> <p>Configuration Example: <pre><code>general:\n  language: en\n  log_level: info\n\nmodel:\n  provider: openrouter\n  model: amazon/nova-2-lite-v1:free\n\nssh:\n  connect_timeout: 30\n  pool_timeout: 600\n</code></pre></p>"},{"location":"architecture/decisions/#adr-007-plugin-architecture","title":"ADR-007: Plugin Architecture","text":"<p>Status: Proposed</p> <p>Context: Users need to extend Merlya with custom tools.</p> <p>Decision: Entry-point based plugin system.</p> <p>Rationale: - Standard Python packaging approach - Easy distribution via PyPI - Namespace isolation - Lazy loading</p> <p>Proposed Interface: <pre><code># pyproject.toml\n[project.entry-points.\"merlya.tools\"]\nmy_tool = \"my_package:MyTool\"\n\n# Implementation\nclass MyTool(MerlyaTool):\n    name = \"my_tool\"\n    description = \"Does something useful\"\n\n    async def execute(self, params: dict) -&gt; ToolResult:\n        ...\n</code></pre></p>"},{"location":"architecture/decisions/#adr-008-loguru-for-logging","title":"ADR-008: Loguru for Logging","text":"<p>Status: Accepted</p> <p>Context: Debugging and monitoring require good logging with minimal configuration.</p> <p>Decision: Use loguru for logging.</p> <p>Rationale: - Zero-configuration out of the box - Automatic rotation and retention - Human-readable colored output for development - Exception catching with full traceback - Easy to use API (<code>logger.info()</code>, <code>logger.error()</code>) - Async-safe</p> <p>Implementation: <pre><code>from loguru import logger\n\nlogger.info(\"\u2705 Operation completed successfully\")\nlogger.warning(\"\u26a0\ufe0f Connection retry required\")\nlogger.error(\"\u274c SSH connection failed: {error}\", error=e)\n</code></pre></p> <p>Log Levels: - DEBUG: Detailed execution flow - INFO: Key operations and results - WARNING: Recoverable issues - ERROR: Failures requiring attention</p> <p>Emoji Convention: All log messages use emojis for visual clarity (see CONTRIBUTING.md).</p>"},{"location":"architecture/decisions/#adr-009-multi-provider-llm-support","title":"ADR-009: Multi-Provider LLM Support","text":"<p>Status: Accepted</p> <p>Context: Users have different LLM provider preferences and cost constraints.</p> <p>Decision: Abstract LLM provider interface with multiple implementations. OpenRouter as default for free tier access.</p> <p>Supported Providers: - OpenRouter (default) - 100+ models, free tier available - OpenAI (GPT-4o, GPT-4o-mini) - Anthropic (Claude 3.5 Sonnet, Haiku) - Ollama (local models, no API key needed)</p> <p>Interface: <pre><code>class LLMProvider(Protocol):\n    async def generate(prompt: str) -&gt; str\n    async def generate_with_tools(prompt: str, tools: list) -&gt; ToolCall\n</code></pre></p>"},{"location":"architecture/decisions/#adr-010-security-model","title":"ADR-010: Security Model","text":"<p>Status: Accepted</p> <p>Context: Merlya executes commands on remote systems.</p> <p>Decision: Implement defense-in-depth security model.</p> <p>Layers: 1. Credential Protection - Keyring storage 2. Command Review - User confirmation for destructive commands 3. Input Validation - Pydantic models for all inputs 4. Audit Logging - All commands logged 5. Principle of Least Privilege - Minimal permissions</p> <p>Dangerous Command Detection: <pre><code>DANGEROUS_PATTERNS = [\n    r\"rm\\s+-rf\",\n    r\"mkfs\",\n    r\"dd\\s+if=\",\n    r\"&gt;\\s*/dev/\",\n    r\"chmod\\s+777\",\n]\n</code></pre></p>"},{"location":"architecture/decisions/#future-considerations","title":"Future Considerations","text":""},{"location":"architecture/decisions/#under-evaluation","title":"Under Evaluation","text":"<ul> <li>WebSocket support for real-time streaming</li> <li>Kubernetes integration via kubectl</li> <li>Terraform integration for IaC</li> <li>Metrics collection for monitoring dashboards</li> </ul>"},{"location":"architecture/decisions/#rejected","title":"Rejected","text":"<ul> <li>GUI Application - Focus on CLI/API for automation</li> <li>Custom LLM training - Too resource-intensive for scope</li> <li>Multi-tenant SaaS - Security complexity, out of scope</li> </ul>"},{"location":"getting-started/configuration/","title":"Configuration","text":"<p>Merlya uses a layered configuration system with sensible defaults.</p>"},{"location":"getting-started/configuration/#configuration-files","title":"Configuration Files","text":"File Purpose <code>~/.merlya/config.yaml</code> Main configuration <code>~/.merlya/merlya.db</code> Hosts inventory (SQLite) <code>~/.merlya/history</code> Command history <code>~/.merlya/logs/</code> Log files"},{"location":"getting-started/configuration/#configuration-file","title":"Configuration File","text":"<p>Configuration is stored in <code>~/.merlya/config.yaml</code>:</p> <pre><code># ~/.merlya/config.yaml\ngeneral:\n  language: en          # UI language (en, fr)\n  log_level: info       # debug, info, warning, error\n\nmodel:\n  provider: openrouter  # openrouter, anthropic, openai, ollama\n  model: amazon/nova-2-lite-v1:free\n  api_key_env: OPENROUTER_API_KEY\n\nrouter:\n  type: local           # local (ONNX) or llm\n  llm_fallback: openrouter:google/gemini-2.0-flash-lite-001\n\nssh:\n  connect_timeout: 30\n  pool_timeout: 600\n  command_timeout: 60\n</code></pre>"},{"location":"getting-started/configuration/#setting-values","title":"Setting Values","text":"<p>Use the <code>config</code> command to manage settings:</p> <pre><code># Set a value\nmerlya config set llm.provider anthropic\n\n# Get a value\nmerlya config get llm.provider\n\n# Show all settings\nmerlya config show\n</code></pre>"},{"location":"getting-started/configuration/#environment-variables","title":"Environment Variables","text":"<p>API keys and settings can be set via environment variables:</p> <pre><code>export OPENROUTER_API_KEY=or-xxx\nexport OPENAI_API_KEY=sk-xxx\nexport ANTHROPIC_API_KEY=sk-ant-xxx\nexport OLLAMA_API_KEY=xxx  # For cloud Ollama only\n\n# Override settings\nexport MERLYA_LOG_LEVEL=debug\nexport MERLYA_ROUTER_FALLBACK=openai:gpt-4o-mini\n</code></pre>"},{"location":"getting-started/configuration/#llm-configuration","title":"LLM Configuration","text":""},{"location":"getting-started/configuration/#provider-settings","title":"Provider Settings","text":"Setting Description Default <code>llm.provider</code> LLM provider <code>openrouter</code> <code>llm.model</code> Model name <code>amazon/nova-2-lite-v1:free</code> <code>llm.api_key</code> API key (stored in keyring) - <p>Supported Providers:</p> Provider Description <code>openrouter</code> 100+ models, free tier available (default) <code>anthropic</code> Claude models <code>openai</code> GPT models <code>ollama</code> Local or cloud models"},{"location":"getting-started/configuration/#api-keys","title":"API Keys","text":"<p>API keys are stored securely in your system keyring:</p> <ul> <li>macOS: Keychain</li> <li>Linux: Secret Service (GNOME Keyring, KWallet)</li> <li>Windows: Credential Manager</li> </ul> <pre><code># Set API key (stored securely in keyring)\nmerlya config set llm.api_key sk-your-key\n\n# Keys are never written to config files\ncat ~/.merlya/config.yaml | grep api_key\n# (no output - only api_key_env reference, not the actual key)\n</code></pre>"},{"location":"getting-started/configuration/#ssh-configuration","title":"SSH Configuration","text":"Setting Description Default <code>ssh.connect_timeout</code> Connection timeout (seconds) <code>30</code> <code>ssh.pool_timeout</code> Pool timeout (seconds) <code>600</code> <code>ssh.command_timeout</code> Command execution timeout <code>60</code>"},{"location":"getting-started/configuration/#hosts-management","title":"Hosts Management","text":"<p>Hosts are stored in a SQLite database (<code>~/.merlya/merlya.db</code>) and managed via slash commands:</p> <pre><code># Add a host interactively\n/hosts add web-01\n\n# Import from SSH config\n/hosts import ~/.ssh/config --format=ssh\n\n# Import from /etc/hosts\n/hosts import /etc/hosts --format=etc_hosts\n\n# List all hosts\n/hosts list\n\n# Show host details\n/hosts show web-01\n</code></pre> <p>Supported Import Formats:</p> Format Description <code>ssh</code> SSH config file (<code>~/.ssh/config</code>) <code>etc_hosts</code> Linux <code>/etc/hosts</code> format <code>json</code> JSON array of host objects <code>yaml</code> YAML host configuration <code>csv</code> CSV with columns: name, hostname, port, username"},{"location":"getting-started/configuration/#logging","title":"Logging","text":"<p>Merlya uses loguru for logging.</p> Setting Description Default <code>general.log_level</code> Console log level <code>info</code> <code>logging.file_level</code> File log level <code>debug</code> <code>logging.max_size_mb</code> Max log file size <code>10</code> <p>Logs are stored in <code>~/.merlya/logs/</code>.</p>"},{"location":"getting-started/configuration/#next-steps","title":"Next Steps","text":"<ul> <li>SSH Management Guide</li> <li>LLM Providers Guide</li> <li>Automation Guide</li> </ul>"},{"location":"getting-started/installation/","title":"Installation","text":""},{"location":"getting-started/installation/#requirements","title":"Requirements","text":"<ul> <li>Python 3.11 or higher</li> <li>pip (Python package manager)</li> <li>An LLM provider API key (OpenAI, Anthropic, or local Ollama)</li> </ul>"},{"location":"getting-started/installation/#install-from-pypi","title":"Install from PyPI","text":"<p>The recommended way to install Merlya is via pip:</p> <pre><code>pip install merlya\n</code></pre>"},{"location":"getting-started/installation/#install-from-source","title":"Install from Source","text":"<p>For the latest development version:</p> <pre><code>git clone https://github.com/m-kis/merlya.git\ncd merlya\npip install -e \".[dev]\"\n</code></pre>"},{"location":"getting-started/installation/#verify-installation","title":"Verify Installation","text":"<pre><code>merlya --version\n</code></pre> <p>You should see output like:</p> <pre><code>merlya 0.6.0\n</code></pre>"},{"location":"getting-started/installation/#shell-completion","title":"Shell Completion","text":"BashZshFish <pre><code># Add to ~/.bashrc\neval \"$(_MERLYA_COMPLETE=bash_source merlya)\"\n</code></pre> <pre><code># Add to ~/.zshrc\neval \"$(_MERLYA_COMPLETE=zsh_source merlya)\"\n</code></pre> <pre><code># Add to ~/.config/fish/completions/merlya.fish\n_MERLYA_COMPLETE=fish_source merlya | source\n</code></pre>"},{"location":"getting-started/installation/#next-steps","title":"Next Steps","text":"<ul> <li>Quick Start Guide - Get up and running in 5 minutes</li> <li>Configuration - Configure your LLM provider and settings</li> </ul>"},{"location":"getting-started/quickstart/","title":"Quick Start","text":"<p>Get Merlya up and running in 5 minutes.</p>"},{"location":"getting-started/quickstart/#1-first-run-setup-wizard","title":"1. First Run - Setup Wizard","text":"<p>On first launch, Merlya's setup wizard guides you through configuration:</p> <pre><code>merlya\n</code></pre>"},{"location":"getting-started/quickstart/#language-selection","title":"Language Selection","text":"<pre><code>\u256d\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256e\n\u2502                        Merlya Setup                              \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502  Welcome to Merlya! / Bienvenue dans Merlya!                    \u2502\n\u2502                                                                  \u2502\n\u2502  Select your language / Choisissez votre langue:                \u2502\n\u2502    1. English                                                    \u2502\n\u2502    2. Fran\u00e7ais                                                   \u2502\n\u2570\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256f\n</code></pre>"},{"location":"getting-started/quickstart/#llm-provider-selection","title":"LLM Provider Selection","text":"<pre><code>\u256d\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256e\n\u2502                      LLM Configuration                           \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502  1. OpenRouter (recommended) - Free models available             \u2502\n\u2502  2. Anthropic - Claude models                                    \u2502\n\u2502  3. OpenAI - GPT models                                          \u2502\n\u2502  4. Ollama - Local models (no API key needed)                    \u2502\n\u2570\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256f\n\nSelect provider [1]:\n</code></pre> <p>OpenRouter Recommended</p> <p>OpenRouter offers free models and access to 100+ LLMs. Get your API key at openrouter.ai/keys</p>"},{"location":"getting-started/quickstart/#host-discovery","title":"Host Discovery","text":"<p>The wizard automatically detects hosts from:</p> <ul> <li><code>~/.ssh/config</code> - SSH configuration</li> <li><code>~/.ssh/known_hosts</code> - Previously connected hosts</li> <li><code>/etc/hosts</code> - Local host definitions</li> <li>Ansible inventory files</li> </ul> <pre><code>Detected inventory sources:\n  \u2022 SSH Config: 12 hosts\n  \u2022 Known Hosts: 45 hosts\n\nImport all hosts? [Y/n]:\n</code></pre>"},{"location":"getting-started/quickstart/#2-manual-configuration-alternative","title":"2. Manual Configuration (Alternative)","text":"<p>If you skip the wizard or want to change settings later:</p> OpenRouter (Free)OpenAIAnthropicOllama (Local) <pre><code>merlya config set llm.provider openrouter\nmerlya config set llm.api_key or-your-api-key\nmerlya config set llm.model amazon/nova-2-lite-v1:free\n</code></pre> <pre><code>merlya config set llm.provider openai\nmerlya config set llm.api_key sk-your-api-key\nmerlya config set llm.model gpt-4o-mini\n</code></pre> <pre><code>merlya config set llm.provider anthropic\nmerlya config set llm.api_key sk-ant-your-api-key\nmerlya config set llm.model claude-3-5-sonnet-latest\n</code></pre> <pre><code># First, install Ollama: https://ollama.ai\nollama pull llama3.2\n\nmerlya config set llm.provider ollama\nmerlya config set llm.model llama3.2\n</code></pre>"},{"location":"getting-started/quickstart/#3-start-the-repl","title":"3. Start the REPL","text":"<pre><code>merlya chat\n</code></pre> <p>You'll see the welcome screen with status indicators:</p> <pre><code>\u256d\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256e\n\u2502                              Welcome                              \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502  \ud83d\ude80 Merlya v0.6.0 - Interactive Mode                             \u2502\n\u2502                                                                   \u2502\n\u2502  Provider: \u2705 openrouter (amazon/nova-2-lite-v1:free)            \u2502\n\u2502  Router: \u2705 local (intent-classifier-v1)                          \u2502\n\u2502  Keyring: \u2705 Keyring                                              \u2502\n\u2502                                                                   \u2502\n\u2502  Ask naturally or use slash commands:                             \u2502\n\u2502    \u2022 /help - Show commands                                        \u2502\n\u2502    \u2022 /exit - Quit                                                 \u2502\n\u2570\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256f\n\n\u256d\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256e\n\u2502                           \u26a0\ufe0f  Warning                             \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502  \u26a0\ufe0f  EXPERIMENTAL SOFTWARE                                        \u2502\n\u2502                                                                   \u2502\n\u2502  This tool is in early development. Use for debugging/testing    \u2502\n\u2502  only, NOT production.                                           \u2502\n\u2570\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256f\n</code></pre> <p>Experimental Software</p> <p>Always review commands before executing them on production systems.</p>"},{"location":"getting-started/quickstart/#4-try-some-commands","title":"4. Try Some Commands","text":""},{"location":"getting-started/quickstart/#natural-language","title":"Natural Language","text":"<pre><code>Merlya &gt; What can you help me with?\n\nI can help you with:\n- Managing SSH connections to servers\n- Executing commands on remote machines\n- Checking system status and metrics\n- Automating routine DevOps tasks\n\nJust describe what you need in plain English!\n</code></pre>"},{"location":"getting-started/quickstart/#connect-to-a-server","title":"Connect to a Server","text":"<pre><code>Merlya &gt; Connect to my-server.example.com and show me the uptime\n\nConnecting to my-server.example.com...\n\n&gt; ssh my-server.example.com \"uptime\"\n\n 14:32:01 up 45 days,  3:21,  2 users,  load average: 0.15, 0.10, 0.05\n\nThe server has been running for 45 days with low load averages.\n</code></pre>"},{"location":"getting-started/quickstart/#use-mentions","title":"Use @ Mentions","text":"<pre><code>Merlya &gt; Check disk space on @web-01 and @web-02\n\n&gt; ssh web-01 \"df -h /\"\n&gt; ssh web-02 \"df -h /\"\n\nSummary:\n- web-01: 45% used (55GB free)\n- web-02: 62% used (38GB free)\n</code></pre>"},{"location":"getting-started/quickstart/#slash-commands","title":"Slash Commands","text":"<pre><code>Merlya &gt; /hosts\n\nName     | Hostname              | User   | Tags\n---------|----------------------|--------|------------------\nweb-01   | web-01.example.com   | deploy | ssh-config\nweb-02   | web-02.example.com   | deploy | ssh-config\ndb-01    | 10.0.1.50            | admin  | known-hosts\n</code></pre>"},{"location":"getting-started/quickstart/#common-commands","title":"Common Commands","text":"Command Description <code>merlya</code> Start interactive REPL <code>merlya run \"...\"</code> Run command non-interactively <code>merlya config list</code> Show current configuration <code>merlya config set KEY VALUE</code> Set a configuration value <code>/help</code> Show available slash commands <code>/hosts</code> List configured hosts <code>/new</code> Start a new conversation <code>/exit</code> Exit the REPL"},{"location":"getting-started/quickstart/#next-steps","title":"Next Steps","text":"<ul> <li>REPL Mode - Deep dive into the interactive interface</li> <li>Automation Guide - Non-interactive mode, CI/CD, scripting</li> <li>Configuration Guide - Advanced configuration options</li> <li>SSH Management - SSH features and connection pooling</li> <li>LLM Providers - Configure different LLM providers</li> </ul>"},{"location":"guides/automation/","title":"Automation","text":"<p>Automate infrastructure tasks with Merlya's scripting and scheduling capabilities.</p>"},{"location":"guides/automation/#non-interactive-mode","title":"Non-Interactive Mode","text":"<p>Run Merlya commands without interactive prompts:</p> <pre><code># Single command\nmerlya run \"Check disk space on all web servers\"\n\n# From file\nmerlya run --file tasks.txt\n\n# With confirmation disabled (use with caution)\nmerlya run --yes \"Restart nginx on web-01\"\n</code></pre>"},{"location":"guides/automation/#task-files","title":"Task Files","text":"<p>Create reusable task files:</p> <pre><code># tasks/daily-checks.yml\nname: Daily Infrastructure Checks\ntasks:\n  - description: Check disk space\n    prompt: Check disk usage on all servers, warn if above 80%\n\n  - description: Check memory\n    prompt: Check memory usage on all servers\n\n  - description: Check services\n    prompt: Verify nginx and postgres are running on all servers\n</code></pre> <p>Run the task file:</p> <pre><code>merlya run --file tasks/daily-checks.yml\n</code></pre>"},{"location":"guides/automation/#cron-integration","title":"Cron Integration","text":"<p>Schedule Merlya tasks with cron:</p> <pre><code># Edit crontab\ncrontab -e\n\n# Daily health check at 6 AM\n0 6 * * * /usr/local/bin/merlya run \"Run daily health checks\" &gt;&gt; /var/log/merlya-daily.log 2&gt;&amp;1\n\n# Hourly disk check\n0 * * * * /usr/local/bin/merlya run \"Check disk space, alert if above 90%\" &gt;&gt; /var/log/merlya-disk.log 2&gt;&amp;1\n</code></pre>"},{"location":"guides/automation/#webhooks","title":"Webhooks","text":"<p>Trigger Merlya from webhooks:</p> <pre><code>#!/bin/bash\n# webhook-handler.sh\n\nPAYLOAD=$(cat)\nEVENT=$(echo $PAYLOAD | jq -r '.event')\n\ncase $EVENT in\n  \"deploy\")\n    merlya run \"Deploy latest version to staging servers\"\n    ;;\n  \"rollback\")\n    merlya run \"Rollback to previous version on staging\"\n    ;;\n  \"scale-up\")\n    merlya run \"Start 2 additional web servers\"\n    ;;\nesac\n</code></pre>"},{"location":"guides/automation/#cicd-integration","title":"CI/CD Integration","text":""},{"location":"guides/automation/#github-actions","title":"GitHub Actions","text":"<pre><code>name: Deploy with Merlya\n\non:\n  push:\n    branches: [main]\n\njobs:\n  deploy:\n    runs-on: ubuntu-latest\n    steps:\n      - uses: actions/checkout@v4\n\n      - name: Install Merlya\n        run: pip install merlya\n\n      - name: Configure Merlya\n        run: |\n          merlya config set llm.provider openai\n          merlya config set llm.api_key ${{ secrets.OPENAI_API_KEY }}\n\n      - name: Deploy\n        run: |\n          merlya run --yes \"Deploy the latest code to production servers\"\n</code></pre>"},{"location":"guides/automation/#gitlab-ci","title":"GitLab CI","text":"<pre><code>deploy:\n  stage: deploy\n  script:\n    - pip install merlya\n    - merlya config set llm.provider openai\n    - merlya config set llm.api_key $OPENAI_API_KEY\n    - merlya run --yes \"Deploy version $CI_COMMIT_TAG to production\"\n  only:\n    - tags\n</code></pre>"},{"location":"guides/automation/#output-formats","title":"Output Formats","text":"<p>Control output format for automation:</p> <pre><code># JSON output (for parsing)\nmerlya run --format json \"List all servers with high CPU\"\n\n# Quiet mode (only results)\nmerlya run --quiet \"Check nginx status\"\n\n# Verbose mode (full logging)\nmerlya run --verbose \"Deploy to production\"\n</code></pre>"},{"location":"guides/automation/#json-output-example","title":"JSON Output Example","text":"<pre><code>merlya run --format json \"Check disk space on web-01\"\n</code></pre> <pre><code>{\n  \"success\": true,\n  \"server\": \"web-01\",\n  \"command\": \"df -h /\",\n  \"output\": \"Filesystem      Size  Used Avail Use%\\n/dev/sda1       100G   45G   55G  45%\",\n  \"analysis\": {\n    \"disk_used_percent\": 45,\n    \"disk_free_gb\": 55,\n    \"status\": \"healthy\"\n  }\n}\n</code></pre>"},{"location":"guides/automation/#error-handling","title":"Error Handling","text":"<p>Handle errors in scripts:</p> <pre><code>#!/bin/bash\nset -e\n\n# Run with error handling\nif merlya run --quiet \"Check if all services are healthy\"; then\n    echo \"All services healthy\"\nelse\n    echo \"Service check failed!\"\n    merlya run \"Send alert to ops team about service failures\"\n    exit 1\nfi\n</code></pre>"},{"location":"guides/automation/#logging","title":"Logging","text":"<p>Configure logging for automation:</p> <pre><code># Set log level\nmerlya config set logging.level DEBUG\n\n# Set log file\nmerlya config set logging.file /var/log/merlya/automation.log\n\n# Run with specific log file\nMERLYA_LOG_FILE=/tmp/task.log merlya run \"Check servers\"\n</code></pre>"},{"location":"guides/automation/#best-practices","title":"Best Practices","text":"<ol> <li>Use <code>--yes</code> carefully - Only for well-tested tasks</li> <li>Log everything - Keep records of automated actions</li> <li>Set timeouts - Prevent hanging tasks</li> <li>Use JSON output - For reliable parsing</li> <li>Test in staging - Before automating production tasks</li> <li>Monitor failures - Set up alerts for failed tasks</li> </ol>"},{"location":"guides/automation/#examples","title":"Examples","text":""},{"location":"guides/automation/#daily-backup-check","title":"Daily Backup Check","text":"<pre><code>#!/bin/bash\n# check-backups.sh\n\nLOG_FILE=\"/var/log/merlya/backup-check.log\"\n\necho \"$(date): Starting backup check\" &gt;&gt; $LOG_FILE\n\nRESULT=$(merlya run --format json \"Verify all database backups from last 24h exist and are valid\")\n\nif echo $RESULT | jq -e '.success' &gt; /dev/null; then\n    echo \"$(date): Backup check passed\" &gt;&gt; $LOG_FILE\nelse\n    echo \"$(date): Backup check FAILED\" &gt;&gt; $LOG_FILE\n    merlya run \"Send urgent alert: backup verification failed\"\nfi\n</code></pre>"},{"location":"guides/automation/#auto-scaling","title":"Auto-Scaling","text":"<pre><code>#!/bin/bash\n# auto-scale.sh\n\nCPU=$(merlya run --format json \"Get average CPU across web tier\" | jq '.cpu_percent')\n\nif (( $(echo \"$CPU &gt; 80\" | bc -l) )); then\n    merlya run --yes \"Scale up web tier by 2 instances\"\nelif (( $(echo \"$CPU &lt; 20\" | bc -l) )); then\n    merlya run --yes \"Scale down web tier by 1 instance (keep minimum 2)\"\nfi\n</code></pre>"},{"location":"guides/llm-providers/","title":"LLM Providers","text":"<p>Merlya supports multiple LLM providers, from cloud APIs to local models.</p>"},{"location":"guides/llm-providers/#supported-providers","title":"Supported Providers","text":"Provider Models Pros Cons OpenRouter 100+ models Free tier, many models Variable latency Anthropic Claude 3.5 Sonnet/Haiku Great reasoning Paid API OpenAI GPT-4o, GPT-4o-mini Fast, reliable Paid API Ollama Llama, Qwen, Mistral Free, private (local or cloud) Setup required"},{"location":"guides/llm-providers/#openrouter-default","title":"OpenRouter (Default)","text":"<p>OpenRouter is the default provider - it offers access to 100+ models including free options.</p>"},{"location":"guides/llm-providers/#setup","title":"Setup","text":"<pre><code>merlya config set llm.provider openrouter\nmerlya config set llm.api_key or-your-api-key\nmerlya config set llm.model amazon/nova-2-lite-v1:free\n</code></pre>"},{"location":"guides/llm-providers/#free-models","title":"Free Models","text":"Model Quality Speed <code>amazon/nova-2-lite-v1:free</code> Good Fast <code>google/gemini-2.0-flash-lite-001</code> Great Fast <code>meta-llama/llama-3.2-3b-instruct:free</code> Good Very fast"},{"location":"guides/llm-providers/#premium-models","title":"Premium Models","text":"Model Quality Cost <code>anthropic/claude-3.5-sonnet</code> Excellent $$ <code>openai/gpt-4o</code> Excellent $$ <code>google/gemini-pro</code> Great $ <p>Get your API key at: openrouter.ai/keys</p>"},{"location":"guides/llm-providers/#anthropic","title":"Anthropic","text":""},{"location":"guides/llm-providers/#setup_1","title":"Setup","text":"<pre><code>merlya config set llm.provider anthropic\nmerlya config set llm.api_key sk-ant-your-api-key\nmerlya config set llm.model claude-3-5-sonnet-latest\n</code></pre>"},{"location":"guides/llm-providers/#recommended-models","title":"Recommended Models","text":"Model Speed Quality Cost <code>claude-3-5-sonnet-latest</code> Fast Excellent $$ <code>claude-3-5-haiku-latest</code> Very fast Great $ <code>claude-3-opus-latest</code> Slow Best $$$"},{"location":"guides/llm-providers/#openai","title":"OpenAI","text":""},{"location":"guides/llm-providers/#setup_2","title":"Setup","text":"<pre><code>merlya config set llm.provider openai\nmerlya config set llm.api_key sk-your-api-key\nmerlya config set llm.model gpt-4o\n</code></pre>"},{"location":"guides/llm-providers/#recommended-models_1","title":"Recommended Models","text":"Model Speed Quality Cost <code>gpt-4o</code> Fast Excellent $$ <code>gpt-4o-mini</code> Very fast Great $ <code>gpt-4-turbo</code> Medium Excellent $$$"},{"location":"guides/llm-providers/#custom-base-url","title":"Custom Base URL","text":"<p>For Azure OpenAI or proxies:</p> <pre><code>merlya config set llm.base_url https://your-endpoint.openai.azure.com\n</code></pre>"},{"location":"guides/llm-providers/#ollama-local-cloud","title":"Ollama (Local + Cloud)","text":"<p>Ollama supports both local and cloud deployment.</p>"},{"location":"guides/llm-providers/#local-setup-free-private","title":"Local Setup (Free, Private)","text":"<pre><code># Install Ollama\ncurl -fsSL https://ollama.ai/install.sh | sh\n\n# Pull a model\nollama pull llama3.2\n\n# Configure Merlya\nmerlya config set llm.provider ollama\nmerlya config set llm.model llama3.2\n# Base URL defaults to http://localhost:11434\n</code></pre>"},{"location":"guides/llm-providers/#cloud-setup-ollamacom","title":"Cloud Setup (Ollama.com)","text":"<p>For cloud-hosted Ollama:</p> <pre><code>merlya config set llm.provider ollama\nmerlya config set llm.model llama3.2-cloud  # \"cloud\" suffix triggers cloud mode\nmerlya config set llm.api_key your-ollama-api-key\nmerlya config set llm.base_url https://ollama.com/v1\n</code></pre> <p>Automatic Cloud Detection</p> <p>Merlya automatically detects cloud mode when:</p> <ul> <li>Model name contains \"cloud\"</li> <li>Base URL is not localhost/127.0.0.1</li> <li><code>OLLAMA_API_KEY</code> environment variable is set</li> </ul>"},{"location":"guides/llm-providers/#recommended-local-models","title":"Recommended Local Models","text":"Model RAM Quality Speed <code>llama3.2</code> 4GB Great Fast <code>qwen2.5:7b</code> 8GB Excellent Fast <code>mistral-nemo:12b</code> 16GB Excellent Medium <code>codellama:13b</code> 16GB Great for code Medium"},{"location":"guides/llm-providers/#gpu-acceleration","title":"GPU Acceleration","text":"<p>Ollama automatically uses GPU if available:</p> <pre><code># Check GPU usage\nollama ps\n\n# Force CPU only\nOLLAMA_GPU_LAYERS=0 ollama serve\n</code></pre>"},{"location":"guides/llm-providers/#provider-selection-in-setup-wizard","title":"Provider Selection in Setup Wizard","text":"<p>On first run, Merlya's setup wizard offers:</p> <pre><code>\u256d\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256e\n\u2502                      LLM Configuration                          \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502  1. OpenRouter (recommended) - Free models available            \u2502\n\u2502  2. Anthropic - Claude models                                   \u2502\n\u2502  3. OpenAI - GPT models                                         \u2502\n\u2502  4. Ollama - Local models (no API key needed)                   \u2502\n\u2570\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256f\n</code></pre>"},{"location":"guides/llm-providers/#router-fallback-model","title":"Router Fallback Model","text":"<p>Merlya uses a separate \"router\" model for intent classification when the local ONNX classifier is unavailable:</p> <pre><code># Configure router fallback (fast, cheap model recommended)\nmerlya config set router.llm_fallback openrouter:google/gemini-2.0-flash-lite-001\n</code></pre>"},{"location":"guides/llm-providers/#switching-providers","title":"Switching Providers","text":"<pre><code># Use OpenRouter for free tier\nmerlya config set llm.provider openrouter\nmerlya config set llm.model amazon/nova-2-lite-v1:free\n\n# Switch to Anthropic for complex tasks\nmerlya config set llm.provider anthropic\n\n# Switch to local Ollama for privacy\nmerlya config set llm.provider ollama\nmerlya config set llm.model llama3.2\n</code></pre>"},{"location":"guides/llm-providers/#environment-variables","title":"Environment Variables","text":"<p>Override settings with environment variables:</p> <pre><code>export OPENROUTER_API_KEY=or-xxx\nexport OPENAI_API_KEY=sk-xxx\nexport ANTHROPIC_API_KEY=sk-ant-xxx\nexport OLLAMA_API_KEY=xxx  # For cloud Ollama only\nexport OLLAMA_BASE_URL=http://localhost:11434/v1\n</code></pre>"},{"location":"guides/llm-providers/#troubleshooting","title":"Troubleshooting","text":""},{"location":"guides/llm-providers/#api-key-issues","title":"API Key Issues","text":"<pre><code># Verify API key is set\nmerlya config get llm.api_key\n\n# Re-set API key (stored in keyring)\nmerlya config set llm.api_key your-new-key\n</code></pre>"},{"location":"guides/llm-providers/#keyring-unavailable","title":"Keyring Unavailable","text":"<p>If you see \"Keyring unavailable (in-memory)\" warning:</p> <pre><code># Linux: Install secret service\nsudo apt install gnome-keyring\n\n# macOS: Keychain should work automatically\n\n# Fallback: Use environment variables instead\nexport OPENROUTER_API_KEY=your-key\n</code></pre>"},{"location":"guides/llm-providers/#ollama-not-responding","title":"Ollama Not Responding","text":"<pre><code># Check if Ollama is running\ncurl http://localhost:11434/api/tags\n\n# Start Ollama\nollama serve\n\n# Or restart the service\nsystemctl restart ollama\n</code></pre>"},{"location":"guides/repl-mode/","title":"REPL Mode","text":"<p>Merlya's REPL (Read-Eval-Print Loop) is the main interactive interface for working with your infrastructure.</p>"},{"location":"guides/repl-mode/#starting-the-repl","title":"Starting the REPL","text":"<pre><code>merlya\n</code></pre> <p>Or explicitly:</p> <pre><code>merlya chat\n</code></pre>"},{"location":"guides/repl-mode/#welcome-screen","title":"Welcome Screen","text":"<p>On startup, you'll see the welcome screen with system status:</p> <pre><code>\u256d\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256e\n\u2502                                  Welcome                                      \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502  \ud83d\ude80 Merlya v0.6.0 - Interactive Mode                                         \u2502\n\u2502                                                                               \u2502\n\u2502  Environment: dev    Session: 20241208_143022                                \u2502\n\u2502                                                                               \u2502\n\u2502  Provider: \u2705 openrouter (amazon/nova-2-lite-v1:free)                        \u2502\n\u2502  Model: \u2705 openrouter:amazon/nova-2-lite-v1:free                             \u2502\n\u2502  Router: \u2705 local (intent-classifier-v1)                                      \u2502\n\u2502  Keyring: \u2705 Keyring                                                          \u2502\n\u2502                                                                               \u2502\n\u2502  Ask naturally or use slash commands:                                         \u2502\n\u2502    \u2022 /help - Show commands                                                    \u2502\n\u2502    \u2022 /conversations - List all conversations                                  \u2502\n\u2502    \u2022 /new [title] - Start new conversation                                    \u2502\n\u2502    \u2022 /scan - Scan infrastructure                                              \u2502\n\u2502    \u2022 /exit - Quit                                                             \u2502\n\u2502                                                                               \u2502\n\u2502  Start by asking me anything about your infrastructure!                       \u2502\n\u2502                                                                               \u2502\n\u2502  \ud83d\udcdd Feedback: https://github.com/m-kis/merlya/issues                         \u2502\n\u2570\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256f\n\n\u256d\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256e\n\u2502                              \u26a0\ufe0f  Warning                                      \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502  \u26a0\ufe0f  EXPERIMENTAL SOFTWARE                                                    \u2502\n\u2502                                                                               \u2502\n\u2502  This tool is in early development. Use for debugging/testing only,          \u2502\n\u2502  NOT production.                                                              \u2502\n\u2502                                                                               \u2502\n\u2502  Tips for best results:                                                       \u2502\n\u2502  \u2022 Be specific in your requests                                               \u2502\n\u2502  \u2022 Specify the target server name or IP if possible                          \u2502\n\u2502  \u2022 Provide context (service name, error message, etc.)                       \u2502\n\u2570\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256f\n</code></pre> <p>Experimental Software</p> <p>Merlya is in early development. Always review commands before executing them on production systems.</p>"},{"location":"guides/repl-mode/#features","title":"Features","text":""},{"location":"guides/repl-mode/#natural-language-input","title":"Natural Language Input","text":"<p>Just type your request in plain English (or French):</p> <pre><code>Merlya &gt; Check disk space on all web servers\nMerlya &gt; Red\u00e9marre nginx sur web-01\nMerlya &gt; Show me the logs from the last hour on db-master\n</code></pre>"},{"location":"guides/repl-mode/#autocompletion","title":"Autocompletion","text":"<p>The REPL provides intelligent autocompletion:</p> <ul> <li>Slash commands: Type <code>/</code> and press Tab</li> <li>Host mentions: Type <code>@</code> and press Tab to see available hosts</li> <li>Variable mentions: Type <code>@</code> to reference saved variables</li> </ul>"},{"location":"guides/repl-mode/#mentions","title":"@ Mentions","text":"<p>Reference hosts and variables directly in your prompts:</p> <pre><code>Merlya &gt; Check memory on @web-01 and @web-02\nMerlya &gt; Deploy using @deploy_key credentials\n</code></pre> <p>Mentions are automatically expanded before processing.</p>"},{"location":"guides/repl-mode/#command-history","title":"Command History","text":"<ul> <li>Up/Down arrows: Navigate through previous commands</li> <li>History is persisted across sessions in <code>~/.merlya/history</code></li> </ul>"},{"location":"guides/repl-mode/#slash-commands","title":"Slash Commands","text":"Command Description <code>/help</code> Show available commands <code>/help &lt;command&gt;</code> Show help for a specific command <code>/new [title]</code> Start a new conversation <code>/conversations</code> List saved conversations <code>/load &lt;id&gt;</code> Load a previous conversation <code>/hosts</code> List configured hosts <code>/hosts add &lt;name&gt; &lt;host&gt;</code> Add a new host <code>/scan</code> Scan for infrastructure <code>/model</code> Show/change current model <code>/config</code> Show configuration <code>/exit</code> Exit the REPL"},{"location":"guides/repl-mode/#examples","title":"Examples","text":"<pre><code>Merlya &gt; /help\nMerlya &gt; /hosts\nMerlya &gt; /hosts add prod-db db.example.com --user admin\nMerlya &gt; /model openai:gpt-4o\nMerlya &gt; /new \"Debugging nginx issue\"\n</code></pre>"},{"location":"guides/repl-mode/#status-indicators","title":"Status Indicators","text":"<p>The welcome screen shows system status:</p> Indicator Meaning \u2705 Feature is working correctly \u26a0\ufe0f Feature has warnings (check message) \u274c Feature is unavailable"},{"location":"guides/repl-mode/#provider-status","title":"Provider Status","text":"<pre><code>Provider: \u2705 openrouter (amazon/nova-2-lite-v1:free)\n</code></pre> <p>Shows the configured LLM provider and model.</p>"},{"location":"guides/repl-mode/#router-status","title":"Router Status","text":"<pre><code>Router: \u2705 local (intent-classifier-v1)\n</code></pre> <ul> <li>local: Using ONNX intent classifier (fast, offline)</li> <li>llm fallback: Using LLM for routing (requires API calls)</li> <li>pattern: Using regex pattern matching (basic)</li> </ul>"},{"location":"guides/repl-mode/#keyring-status","title":"Keyring Status","text":"<pre><code>Keyring: \u2705 Keyring\nKeyring: \u26a0\ufe0f Keyring unavailable (in-memory)\n</code></pre> <p>API keys are stored securely in your system keyring. If unavailable, they're stored in memory only (lost on exit).</p>"},{"location":"guides/repl-mode/#response-format","title":"Response Format","text":"<p>Agent responses include:</p> <pre><code>Merlya &gt; Check uptime on web-01\n\nConnecting to web-01.example.com...\n\n&gt; ssh web-01 \"uptime\"\n\n 14:32:01 up 45 days,  3:21,  2 users,  load average: 0.15, 0.10, 0.05\n\nThe server has been running for 45 days with low load average, indicating\nstable operation and low system stress.\n\nActions: ssh_execute\nSuggestions: Check memory usage, Review recent logs\n</code></pre> <ul> <li>Command output: The actual command executed and its output</li> <li>Analysis: AI-generated analysis of the results</li> <li>Actions: List of tools/actions used</li> <li>Suggestions: Recommended follow-up actions</li> </ul>"},{"location":"guides/repl-mode/#keyboard-shortcuts","title":"Keyboard Shortcuts","text":"Shortcut Action <code>Ctrl+C</code> Cancel current request <code>Ctrl+D</code> Exit REPL <code>Tab</code> Autocomplete <code>\u2191</code> / <code>\u2193</code> Navigate history <code>Ctrl+R</code> Search history"},{"location":"guides/repl-mode/#session-management","title":"Session Management","text":""},{"location":"guides/repl-mode/#new-conversation","title":"New Conversation","text":"<pre><code>Merlya &gt; /new \"Investigating slow queries\"\n</code></pre> <p>Clears history and starts fresh. Optionally provide a title.</p>"},{"location":"guides/repl-mode/#list-conversations","title":"List Conversations","text":"<pre><code>Merlya &gt; /conversations\n\nID      | Title                      | Messages | Last Updated\n--------|----------------------------|----------|-------------\nabc123  | Debugging nginx issue      | 15       | 2 hours ago\ndef456  | Server migration           | 42       | Yesterday\nghi789  | Investigating slow queries | 3        | Just now\n</code></pre>"},{"location":"guides/repl-mode/#load-conversation","title":"Load Conversation","text":"<pre><code>Merlya &gt; /load abc123\n\nLoaded conversation: \"Debugging nginx issue\" (15 messages)\n</code></pre>"},{"location":"guides/repl-mode/#tips-for-best-results","title":"Tips for Best Results","text":"<ol> <li>Be specific: \"Check disk space on web-01\" is better than \"check disk\"</li> <li>Provide context: \"The nginx service crashed after the update\"</li> <li>Name your targets: Use <code>@hostname</code> or specify the server explicitly</li> <li>Review before executing: Always check commands before running on production</li> <li>Use slash commands: Quick actions like <code>/hosts</code> are faster than natural language</li> </ol>"},{"location":"guides/repl-mode/#language-support","title":"Language Support","text":"<p>Merlya supports English and French. Set your language:</p> <pre><code>merlya config set general.language fr\n</code></pre> <p>Or select during the setup wizard on first run.</p>"},{"location":"guides/ssh-management/","title":"SSH Management","text":"<p>Merlya provides powerful SSH management capabilities with connection pooling, jump hosts, and intelligent retry logic.</p>"},{"location":"guides/ssh-management/#connecting-to-servers","title":"Connecting to Servers","text":""},{"location":"guides/ssh-management/#basic-connection","title":"Basic Connection","text":"<pre><code>Merlya &gt; Connect to server.example.com\n\nConnecting to server.example.com...\nConnected successfully.\n\nMerlya &gt; Run \"uptime\"\n\n&gt; ssh server.example.com \"uptime\"\n 10:30:15 up 30 days,  2:45,  1 user,  load average: 0.08, 0.12, 0.09\n</code></pre>"},{"location":"guides/ssh-management/#with-credentials","title":"With Credentials","text":"<pre><code>Merlya &gt; Connect to server.example.com as user admin with key ~/.ssh/admin_key\n\nConnecting to server.example.com as admin...\nUsing key: ~/.ssh/admin_key\nConnected successfully.\n</code></pre>"},{"location":"guides/ssh-management/#connection-pooling","title":"Connection Pooling","text":"<p>Merlya automatically manages SSH connections:</p> <ul> <li>Reuses connections - No reconnection overhead</li> <li>Automatic cleanup - Idle connections are closed</li> <li>Concurrent connections - Execute on multiple servers in parallel</li> </ul> <pre><code>Merlya &gt; Check uptime on all web servers\n\nExecuting on 5 servers in parallel...\n\nweb-01: up 45 days\nweb-02: up 45 days\nweb-03: up 12 days\nweb-04: up 45 days\nweb-05: up 3 days (recently restarted)\n</code></pre>"},{"location":"guides/ssh-management/#jump-hosts-bastion","title":"Jump Hosts (Bastion)","text":"<p>Connect through a bastion/jump host:</p> <pre><code>Merlya &gt; Connect to internal-db via bastion.example.com\n\nConnecting through jump host: bastion.example.com\nConnected to internal-db via bastion.\n</code></pre> <p>Configure in <code>hosts.toml</code>:</p> <pre><code>[hosts.internal-db]\nhostname = \"10.0.1.50\"\nuser = \"dbadmin\"\njump_host = \"bastion.example.com\"\n</code></pre>"},{"location":"guides/ssh-management/#host-groups","title":"Host Groups","text":"<p>Define and use host groups:</p> <pre><code># ~/.config/merlya/hosts.toml\n[groups.web-tier]\nhosts = [\"web-01\", \"web-02\", \"web-03\"]\n\n[groups.db-tier]\nhosts = [\"db-master\", \"db-replica-01\"]\n</code></pre> <pre><code>Merlya &gt; Restart nginx on all web-tier servers\n\nI'll restart nginx on all web-tier servers (web-01, web-02, web-03).\n\n&gt; ssh web-01 \"sudo systemctl restart nginx\"\n&gt; ssh web-02 \"sudo systemctl restart nginx\"\n&gt; ssh web-03 \"sudo systemctl restart nginx\"\n\nNginx restarted on all 3 servers.\n</code></pre>"},{"location":"guides/ssh-management/#file-transfer","title":"File Transfer","text":""},{"location":"guides/ssh-management/#upload-files","title":"Upload Files","text":"<pre><code>Merlya &gt; Upload config.yml to /etc/app/ on web-01\n\nUploading config.yml to web-01:/etc/app/config.yml...\nTransfer complete (2.3 KB).\n</code></pre>"},{"location":"guides/ssh-management/#download-files","title":"Download Files","text":"<pre><code>Merlya &gt; Download /var/log/app.log from web-01\n\nDownloading web-01:/var/log/app.log...\nSaved to: ./app.log (45 KB)\n</code></pre>"},{"location":"guides/ssh-management/#error-handling","title":"Error Handling","text":""},{"location":"guides/ssh-management/#automatic-retry","title":"Automatic Retry","text":"<p>Failed connections are automatically retried:</p> <pre><code>Merlya &gt; Connect to flaky-server.example.com\n\nConnection attempt 1 failed: Connection timeout\nRetrying in 5 seconds...\nConnection attempt 2 succeeded.\nConnected to flaky-server.example.com.\n</code></pre>"},{"location":"guides/ssh-management/#connection-errors","title":"Connection Errors","text":"<pre><code>Merlya &gt; Connect to unknown-server.example.com\n\nUnable to connect to unknown-server.example.com:\n- Error: Host not found\n- Suggestion: Check the hostname or add it to /etc/hosts\n</code></pre>"},{"location":"guides/ssh-management/#security","title":"Security","text":""},{"location":"guides/ssh-management/#host-key-verification","title":"Host Key Verification","text":"<pre><code>Merlya &gt; Connect to new-server.example.com\n\nWarning: Unknown host key for new-server.example.com\nFingerprint: SHA256:xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx\n\nDo you want to add this host to known_hosts? [y/N]\n</code></pre>"},{"location":"guides/ssh-management/#key-based-authentication","title":"Key-Based Authentication","text":"<p>Merlya supports various SSH key types:</p> <ul> <li>RSA (2048+ bits)</li> <li>Ed25519 (recommended)</li> <li>ECDSA</li> </ul> <pre><code># Generate a new key\nssh-keygen -t ed25519 -f ~/.ssh/merlya_key\n\n# Configure Merlya to use it\nmerlya config set ssh.default_key ~/.ssh/merlya_key\n</code></pre>"},{"location":"guides/ssh-management/#best-practices","title":"Best Practices","text":"<ol> <li>Use SSH keys instead of passwords</li> <li>Configure jump hosts for internal servers</li> <li>Use host groups for batch operations</li> <li>Set appropriate timeouts for slow networks</li> <li>Review commands before execution on production</li> </ol>"},{"location":"guides/ssh-management/#troubleshooting","title":"Troubleshooting","text":""},{"location":"guides/ssh-management/#connection-timeout","title":"Connection Timeout","text":"<pre><code># Increase timeout\nmerlya config set ssh.timeout 60\n</code></pre>"},{"location":"guides/ssh-management/#permission-denied","title":"Permission Denied","text":"<pre><code># Check key permissions\nchmod 600 ~/.ssh/your_key\nchmod 700 ~/.ssh\n</code></pre>"},{"location":"guides/ssh-management/#too-many-connections","title":"Too Many Connections","text":"<pre><code># Adjust pool size\nmerlya config set ssh.max_connections 20\n</code></pre>"},{"location":"reference/api/","title":"API Reference","text":"<p>Merlya can be used as a Python library in your own applications.</p>"},{"location":"reference/api/#installation","title":"Installation","text":"<pre><code>pip install merlya\n</code></pre>"},{"location":"reference/api/#quick-start","title":"Quick Start","text":"<pre><code>from merlya import Merlya\n\n# Initialize with default config\nagent = Merlya()\n\n# Or with custom settings\nagent = Merlya(\n    provider=\"openai\",\n    model=\"gpt-4o-mini\",\n    api_key=\"sk-...\"\n)\n\n# Run a task\nresult = await agent.run(\"Check disk space on web servers\")\nprint(result)\n</code></pre>"},{"location":"reference/api/#core-classes","title":"Core Classes","text":""},{"location":"reference/api/#merlya","title":"Merlya","text":"<p>Main entry point for the library.</p> <pre><code>class Merlya:\n    def __init__(\n        self,\n        provider: str = \"openai\",\n        model: str = None,\n        api_key: str = None,\n        config_path: str = None\n    )\n</code></pre> <p>Parameters:</p> Parameter Type Description <code>provider</code> str LLM provider name <code>model</code> str Model identifier <code>api_key</code> str API key (uses keyring if not provided) <code>config_path</code> str Custom config file path <p>Methods:</p>"},{"location":"reference/api/#run","title":"run","text":"<p>Execute a natural language task.</p> <pre><code>async def run(\n    self,\n    prompt: str,\n    confirm: bool = True,\n    timeout: int = 300\n) -&gt; TaskResult\n</code></pre>"},{"location":"reference/api/#chat","title":"chat","text":"<p>Start an interactive chat session.</p> <pre><code>async def chat(\n    self,\n    system_prompt: str = None,\n    history: list = None\n) -&gt; None\n</code></pre>"},{"location":"reference/api/#connect","title":"connect","text":"<p>Connect to an SSH host.</p> <pre><code>async def connect(\n    self,\n    host: str,\n    user: str = None,\n    key: str = None\n) -&gt; SSHConnection\n</code></pre>"},{"location":"reference/api/#sshconnection","title":"SSHConnection","text":"<p>Represents an SSH connection.</p> <pre><code>class SSHConnection:\n    hostname: str\n    user: str\n    connected: bool\n</code></pre> <p>Methods:</p>"},{"location":"reference/api/#execute","title":"execute","text":"<p>Run a command on the remote host.</p> <pre><code>async def execute(\n    self,\n    command: str,\n    sudo: bool = False,\n    timeout: int = 60\n) -&gt; CommandResult\n</code></pre>"},{"location":"reference/api/#upload","title":"upload","text":"<p>Upload a file to the remote host.</p> <pre><code>async def upload(\n    self,\n    local_path: str,\n    remote_path: str\n) -&gt; None\n</code></pre>"},{"location":"reference/api/#download","title":"download","text":"<p>Download a file from the remote host.</p> <pre><code>async def download(\n    self,\n    remote_path: str,\n    local_path: str\n) -&gt; None\n</code></pre>"},{"location":"reference/api/#close","title":"close","text":"<p>Close the connection.</p> <pre><code>async def close() -&gt; None\n</code></pre>"},{"location":"reference/api/#taskresult","title":"TaskResult","text":"<p>Result of a task execution.</p> <pre><code>@dataclass\nclass TaskResult:\n    success: bool\n    output: str\n    commands: list[CommandResult]\n    analysis: str\n    duration: float\n</code></pre>"},{"location":"reference/api/#commandresult","title":"CommandResult","text":"<p>Result of a single command execution.</p> <pre><code>@dataclass\nclass CommandResult:\n    command: str\n    stdout: str\n    stderr: str\n    exit_code: int\n    host: str\n    duration: float\n</code></pre>"},{"location":"reference/api/#usage-examples","title":"Usage Examples","text":""},{"location":"reference/api/#basic-task-execution","title":"Basic Task Execution","text":"<pre><code>import asyncio\nfrom merlya import Merlya\n\nasync def main():\n    agent = Merlya()\n\n    # Run a task\n    result = await agent.run(\n        \"Check if nginx is running on web-01\",\n        confirm=False\n    )\n\n    if result.success:\n        print(f\"Output: {result.output}\")\n    else:\n        print(f\"Failed: {result.output}\")\n\nasyncio.run(main())\n</code></pre>"},{"location":"reference/api/#ssh-operations","title":"SSH Operations","text":"<pre><code>import asyncio\nfrom merlya import Merlya\n\nasync def main():\n    agent = Merlya()\n\n    # Connect to a server\n    conn = await agent.connect(\"web-01.example.com\", user=\"deploy\")\n\n    # Execute commands\n    result = await conn.execute(\"uptime\")\n    print(f\"Uptime: {result.stdout}\")\n\n    result = await conn.execute(\"df -h /\")\n    print(f\"Disk: {result.stdout}\")\n\n    # Close connection\n    await conn.close()\n\nasyncio.run(main())\n</code></pre>"},{"location":"reference/api/#batch-operations","title":"Batch Operations","text":"<pre><code>import asyncio\nfrom merlya import Merlya\n\nasync def check_server(agent, hostname):\n    conn = await agent.connect(hostname)\n    result = await conn.execute(\"uptime\")\n    await conn.close()\n    return hostname, result.stdout\n\nasync def main():\n    agent = Merlya()\n    servers = [\"web-01\", \"web-02\", \"web-03\"]\n\n    # Run in parallel\n    tasks = [check_server(agent, s) for s in servers]\n    results = await asyncio.gather(*tasks)\n\n    for hostname, uptime in results:\n        print(f\"{hostname}: {uptime}\")\n\nasyncio.run(main())\n</code></pre>"},{"location":"reference/api/#custom-llm-provider","title":"Custom LLM Provider","text":"<pre><code>from merlya import Merlya\n\n# Use Ollama\nagent = Merlya(\n    provider=\"ollama\",\n    model=\"qwen2.5:7b\",\n    base_url=\"http://localhost:11434\"\n)\n\n# Use Anthropic\nagent = Merlya(\n    provider=\"anthropic\",\n    model=\"claude-3-5-sonnet-20241022\",\n    api_key=\"sk-ant-...\"\n)\n</code></pre>"},{"location":"reference/api/#error-handling","title":"Error Handling","text":"<pre><code>import asyncio\nfrom merlya import Merlya\nfrom merlya.exceptions import (\n    ConnectionError,\n    AuthenticationError,\n    CommandError\n)\n\nasync def main():\n    agent = Merlya()\n\n    try:\n        conn = await agent.connect(\"server.example.com\")\n        result = await conn.execute(\"some-command\")\n    except ConnectionError as e:\n        print(f\"Connection failed: {e}\")\n    except AuthenticationError as e:\n        print(f\"Authentication failed: {e}\")\n    except CommandError as e:\n        print(f\"Command failed: {e.exit_code} - {e.stderr}\")\n\nasyncio.run(main())\n</code></pre>"},{"location":"reference/api/#type-hints","title":"Type Hints","text":"<p>Merlya is fully typed. Use with your favorite IDE for autocompletion:</p> <pre><code>from merlya import Merlya, TaskResult, SSHConnection\n\nasync def my_function(agent: Merlya) -&gt; TaskResult:\n    return await agent.run(\"Check servers\")\n</code></pre>"},{"location":"reference/cli/","title":"CLI Reference","text":"<p>Complete reference for all Merlya commands.</p>"},{"location":"reference/cli/#main-commands","title":"Main Commands","text":""},{"location":"reference/cli/#merlya","title":"merlya","text":"<p>Start the interactive REPL.</p> <pre><code>merlya [OPTIONS]\n\nOptions:\n  --version       Show version and exit\n  --help          Show help message and exit\n  -v, --verbose   Enable verbose output\n  -q, --quiet     Suppress non-essential output\n  --config FILE   Use specific config file\n</code></pre>"},{"location":"reference/cli/#merlya-run","title":"merlya run","text":"<p>Execute commands in non-interactive (batch) mode. Ideal for automation, CI/CD, and scripting.</p> <pre><code>merlya run [OPTIONS] [COMMAND]\n\nArguments:\n  COMMAND         Natural language command to execute\n\nOptions:\n  -f, --file FILE     Load tasks from YAML or text file\n  -y, --yes           Skip confirmation prompts (auto-confirm)\n  --format FORMAT     Output format: text (default) or json\n  -q, --quiet         Minimal output\n  -v, --verbose       Verbose logging\n  --help              Show help message\n</code></pre> <p>Examples:</p> <pre><code># Single command\nmerlya run \"Check disk space on all web servers\"\n\n# With auto-confirmation (for automation)\nmerlya run --yes \"Restart nginx on @web-01\"\n\n# JSON output (for parsing)\nmerlya run --format json \"List all servers with high CPU\"\n\n# From task file\nmerlya run --file tasks.yml\n\n# Quiet mode (minimal output)\nmerlya run --quiet --yes \"Check server health\"\n</code></pre> <p>Task File Format (YAML):</p> <pre><code># tasks.yml\ntasks:\n  - description: \"Check disk space\"\n    prompt: \"Check disk usage on all servers, warn if above 80%\"\n\n  - description: \"Check memory\"\n    prompt: \"Check memory usage on all servers\"\n\n  - prompt: \"Verify nginx is running\"\n</code></pre> <p>Task File Format (Text):</p> <pre><code># tasks.txt (one command per line)\nCheck disk space on all servers\nList running services\nVerify backup status\n</code></pre> <p>JSON Output Structure:</p> <pre><code>{\n  \"success\": true,\n  \"total\": 3,\n  \"passed\": 3,\n  \"failed\": 0,\n  \"tasks\": [\n    {\n      \"task\": \"Check disk space\",\n      \"success\": true,\n      \"message\": \"Disk usage: 45% on /dev/sda1\",\n      \"actions\": [\"ssh_execute\"]\n    }\n  ]\n}\n</code></pre> <p>Exit Codes:</p> Code Meaning 0 All tasks succeeded 1 One or more tasks failed"},{"location":"reference/cli/#merlya-config","title":"merlya config","text":"<p>Manage configuration settings.</p> <pre><code>merlya config &lt;SUBCOMMAND&gt;\n\nSubcommands:\n  show          Show current configuration\n  set KEY VAL   Set a configuration value\n  get KEY       Get a configuration value\n</code></pre> <p>Examples:</p> <pre><code>merlya config show\nmerlya config set llm.provider openrouter\nmerlya config get llm.model\n</code></pre>"},{"location":"reference/cli/#repl-slash-commands","title":"REPL Slash Commands","text":"<p>Once inside the Merlya REPL, use slash commands to interact with the system.</p>"},{"location":"reference/cli/#quick-reference","title":"Quick Reference","text":"Category Commands Core <code>/help</code>, <code>/exit</code>, <code>/new</code>, <code>/language</code> Hosts <code>/hosts list</code>, <code>/hosts add</code>, <code>/hosts show</code>, <code>/hosts delete</code>, <code>/hosts tag</code>, <code>/hosts import</code>, <code>/hosts export</code> SSH <code>/ssh connect</code>, <code>/ssh exec</code>, <code>/ssh disconnect</code>, <code>/ssh config</code>, <code>/ssh test</code> Scan <code>/scan</code> Conversations <code>/conv list</code>, <code>/conv show</code>, <code>/conv load</code>, <code>/conv delete</code>, <code>/conv rename</code>, <code>/conv search</code>, <code>/conv export</code> Model <code>/model show</code>, <code>/model provider</code>, <code>/model model</code>, <code>/model test</code>, <code>/model router</code> Variables <code>/variable list</code>, <code>/variable set</code>, <code>/variable get</code>, <code>/variable delete</code> Secrets <code>/secret list</code>, <code>/secret set</code>, <code>/secret delete</code> System <code>/health</code>, <code>/log</code>"},{"location":"reference/cli/#core-commands","title":"Core Commands","text":""},{"location":"reference/cli/#help","title":"/help","text":"<p>Show help for commands.</p> <pre><code>/help [command]\n</code></pre> <p>Aliases: <code>h</code>, <code>?</code></p> <p>Examples: <pre><code>/help              # Show all commands\n/help hosts        # Help for /hosts command\n/help ssh          # Help for /ssh command\n</code></pre></p>"},{"location":"reference/cli/#exit","title":"/exit","text":"<p>Exit Merlya.</p> <pre><code>/exit\n</code></pre> <p>Aliases: <code>quit</code>, <code>q</code></p>"},{"location":"reference/cli/#new","title":"/new","text":"<p>Start a new conversation.</p> <pre><code>/new\n</code></pre>"},{"location":"reference/cli/#language","title":"/language","text":"<p>Change interface language.</p> <pre><code>/language &lt;fr|en&gt;\n</code></pre> <p>Aliases: <code>lang</code></p> <p>Available Languages:</p> <ul> <li><code>fr</code> - French</li> <li><code>en</code> - English</li> </ul> <p>Example: <pre><code>/language en\n</code></pre></p>"},{"location":"reference/cli/#host-management","title":"Host Management","text":""},{"location":"reference/cli/#hosts-list","title":"/hosts list","text":"<p>List all hosts in inventory.</p> <pre><code>/hosts list [--tag=&lt;tag&gt;]\n</code></pre> <p>Options:</p> <ul> <li><code>--tag=&lt;tag&gt;</code> - Filter hosts by tag</li> </ul> <p>Examples: <pre><code>/hosts list\n/hosts list --tag=production\n/hosts list --tag=web\n</code></pre></p>"},{"location":"reference/cli/#hosts-add","title":"/hosts add","text":"<p>Add a new host interactively.</p> <pre><code>/hosts add &lt;name&gt;\n</code></pre> <p>You will be prompted for:</p> <ul> <li>Hostname or IP address</li> <li>SSH port (default: 22)</li> <li>Username</li> </ul> <p>Example: <pre><code>/hosts add web-prod-01\n</code></pre></p>"},{"location":"reference/cli/#hosts-show","title":"/hosts show","text":"<p>Show detailed host information.</p> <pre><code>/hosts show &lt;name&gt;\n</code></pre> <p>Displays:</p> <ul> <li>Hostname and port</li> <li>Username</li> <li>Connection status</li> <li>Tags</li> <li>OS information</li> <li>Last seen timestamp</li> </ul> <p>Example: <pre><code>/hosts show web-prod-01\n</code></pre></p>"},{"location":"reference/cli/#hosts-delete","title":"/hosts delete","text":"<p>Delete a host from inventory.</p> <pre><code>/hosts delete &lt;name&gt;\n</code></pre> <p>Requires confirmation before deletion.</p> <p>Example: <pre><code>/hosts delete old-server\n</code></pre></p>"},{"location":"reference/cli/#hosts-tag","title":"/hosts tag","text":"<p>Add a tag to a host.</p> <pre><code>/hosts tag &lt;name&gt; &lt;tag&gt;\n</code></pre> <p>Example: <pre><code>/hosts tag web-prod-01 production\n/hosts tag web-prod-01 nginx\n</code></pre></p>"},{"location":"reference/cli/#hosts-untag","title":"/hosts untag","text":"<p>Remove a tag from a host.</p> <pre><code>/hosts untag &lt;name&gt; &lt;tag&gt;\n</code></pre> <p>Example: <pre><code>/hosts untag web-prod-01 deprecated\n</code></pre></p>"},{"location":"reference/cli/#hosts-edit","title":"/hosts edit","text":"<p>Edit host configuration interactively.</p> <pre><code>/hosts edit &lt;name&gt;\n</code></pre> <p>You can modify:</p> <ul> <li>Hostname</li> <li>Port</li> <li>Username</li> <li>Tags</li> </ul> <p>Example: <pre><code>/hosts edit web-prod-01\n</code></pre></p>"},{"location":"reference/cli/#hosts-import","title":"/hosts import","text":"<p>Import hosts from a file.</p> <pre><code>/hosts import &lt;file&gt; [--format=&lt;format&gt;]\n</code></pre> <p>Supported Formats:</p> Format Description <code>json</code> JSON array of host objects <code>yaml</code> YAML host configuration <code>toml</code> TOML with <code>[hosts.name]</code> sections <code>csv</code> CSV with columns: name, hostname, port, username, tags <code>ssh</code> SSH config file format (<code>~/.ssh/config</code>) <code>etc_hosts</code> Linux <code>/etc/hosts</code> format <p>Examples: <pre><code>/hosts import ~/hosts.json --format=json\n/hosts import ~/inventory.toml --format=toml\n/hosts import ~/.ssh/config --format=ssh\n/hosts import /etc/hosts --format=etc_hosts\n</code></pre></p> <p>TOML Format Example:</p> <pre><code>[hosts.internal-db]\nhostname = \"10.0.1.50\"\nuser = \"dbadmin\"\njump_host = \"bastion.example.com\"\nport = 22\ntags = [\"database\", \"production\"]\n\n[hosts.bastion]\nhostname = \"bastion.example.com\"\nuser = \"admin\"\n</code></pre> <p>Field Aliases</p> <p>TOML import supports aliases: <code>host</code> for <code>hostname</code>, <code>bastion</code> for <code>jump_host</code>.</p>"},{"location":"reference/cli/#hosts-export","title":"/hosts export","text":"<p>Export hosts to a file.</p> <pre><code>/hosts export &lt;file&gt; [--format=&lt;format&gt;]\n</code></pre> <p>Supported Formats: <code>json</code>, <code>yaml</code>, <code>csv</code></p> <p>Example: <pre><code>/hosts export ~/backup.json --format=json\n</code></pre></p>"},{"location":"reference/cli/#ssh-management","title":"SSH Management","text":""},{"location":"reference/cli/#ssh-connect","title":"/ssh connect","text":"<p>Connect to a host.</p> <pre><code>/ssh connect &lt;host&gt;\n</code></pre> <p>Supports passphrase prompts and MFA/2FA authentication.</p> <p>Examples: <pre><code>/ssh connect web-prod-01\n/ssh connect @web-prod-01\n</code></pre></p>"},{"location":"reference/cli/#ssh-exec","title":"/ssh exec","text":"<p>Execute a command on a remote host.</p> <pre><code>/ssh exec &lt;host&gt; &lt;command&gt;\n</code></pre> <p>Returns exit code, stdout, and stderr.</p> <p>Examples: <pre><code>/ssh exec @web-prod-01 \"uptime\"\n/ssh exec @db-01 \"df -h\"\n/ssh exec @web-prod-01 \"systemctl status nginx\"\n</code></pre></p>"},{"location":"reference/cli/#ssh-disconnect","title":"/ssh disconnect","text":"<p>Disconnect from a host or all hosts.</p> <pre><code>/ssh disconnect [host]\n</code></pre> <p>Without arguments, disconnects from all hosts.</p> <p>Examples: <pre><code>/ssh disconnect web-prod-01    # Disconnect from specific host\n/ssh disconnect                # Disconnect from all hosts\n</code></pre></p>"},{"location":"reference/cli/#ssh-config","title":"/ssh config","text":"<p>Configure SSH settings for a host.</p> <pre><code>/ssh config &lt;host&gt;\n</code></pre> <p>You will be prompted for:</p> <ul> <li>Username</li> <li>Port</li> <li>Private key path</li> <li>Jump host (optional)</li> </ul> <p>Example: <pre><code>/ssh config web-prod-01\n</code></pre></p>"},{"location":"reference/cli/#ssh-test","title":"/ssh test","text":"<p>Test SSH connection with diagnostics.</p> <pre><code>/ssh test &lt;host&gt;\n</code></pre> <p>Shows:</p> <ul> <li>SSH configuration used</li> <li>Connection time</li> <li>OS information</li> <li>Troubleshooting hints for common errors</li> </ul> <p>Example: <pre><code>/ssh test web-prod-01\n</code></pre></p>"},{"location":"reference/cli/#scanning-diagnostics","title":"Scanning &amp; Diagnostics","text":""},{"location":"reference/cli/#scan","title":"/scan","text":"<p>Scan hosts for system information and security issues.</p> <pre><code>/scan &lt;host&gt; [&lt;host2&gt; ...] [options]\n</code></pre> <p>Scan Types:</p> Option Description <code>--full</code> Complete scan (default) <code>--quick</code> Fast check: CPU, memory, disk, ports <code>--security</code> Security checks only <code>--system</code> System checks only <p>Output Options:</p> Option Description <code>--json</code> Output as JSON <p>Additional Options:</p> Option Description <code>--all-disks</code> Check all mounted filesystems <code>--show-all</code> Show all ports and users (no truncation) <code>--no-docker</code> Skip Docker checks <code>--no-updates</code> Skip pending updates check <p>What It Checks:</p> <p>System:</p> <ul> <li>CPU usage and load</li> <li>Memory usage</li> <li>Disk usage</li> <li>Docker containers</li> <li>System information (OS, kernel, uptime)</li> </ul> <p>Security:</p> <ul> <li>Open ports</li> <li>SSH configuration</li> <li>Users and groups</li> <li>SSH keys</li> <li>Sudo configuration</li> <li>Running services</li> <li>Failed login attempts</li> <li>Pending security updates</li> </ul> <p>Severity Scoring: 0-100 scale based on issues found.</p> <p>Examples: <pre><code>/scan @web-prod-01\n/scan @web-prod-01 --quick\n/scan @web-prod-01 @db-01 --security\n/scan @web-prod-01 --full --json\n</code></pre></p>"},{"location":"reference/cli/#health","title":"/health","text":"<p>Show system health status.</p> <pre><code>/health\n</code></pre> <p>Displays health check results and capabilities.</p>"},{"location":"reference/cli/#log","title":"/log","text":"<p>Configure and view logging.</p> <pre><code>/log [subcommand]\n</code></pre> <p>Subcommands:</p> Subcommand Description (none) Show logging configuration <code>level &lt;level&gt;</code> Change log level <code>show</code> Show recent log entries <p>Log Levels: <code>debug</code>, <code>info</code>, <code>warning</code>, <code>error</code></p> <p>Examples: <pre><code>/log\n/log level debug\n/log show\n</code></pre></p>"},{"location":"reference/cli/#conversation-management","title":"Conversation Management","text":""},{"location":"reference/cli/#conv-list","title":"/conv list","text":"<p>List recent conversations.</p> <pre><code>/conv list [--limit=N]\n</code></pre> <p>Options:</p> <ul> <li><code>--limit=N</code> - Number of conversations to show (default: 10)</li> </ul> <p>Displays:</p> <ul> <li>Conversation ID</li> <li>Title</li> <li>Message count</li> <li>Last updated</li> </ul> <p>Example: <pre><code>/conv list --limit=20\n</code></pre></p> <p>Aliases: <code>conversation</code></p>"},{"location":"reference/cli/#conv-show","title":"/conv show","text":"<p>Show conversation details.</p> <pre><code>/conv show &lt;id&gt;\n</code></pre> <p>Displays:</p> <ul> <li>Title</li> <li>Created date</li> <li>Message count</li> <li>Summary</li> <li>Recent messages</li> </ul> <p>Example: <pre><code>/conv show abc12345\n</code></pre></p>"},{"location":"reference/cli/#conv-load","title":"/conv load","text":"<p>Load and resume a conversation.</p> <pre><code>/conv load &lt;id&gt;\n</code></pre> <p>Supports partial ID matching (prefix).</p> <p>Example: <pre><code>/conv load abc12345\n/conv load abc        # Matches by prefix\n</code></pre></p>"},{"location":"reference/cli/#conv-delete","title":"/conv delete","text":"<p>Delete a conversation.</p> <pre><code>/conv delete &lt;id&gt;\n</code></pre> <p>Requires confirmation.</p> <p>Example: <pre><code>/conv delete abc12345\n</code></pre></p>"},{"location":"reference/cli/#conv-rename","title":"/conv rename","text":"<p>Rename a conversation.</p> <pre><code>/conv rename &lt;id&gt; &lt;title&gt;\n</code></pre> <p>Example: <pre><code>/conv rename abc12345 \"Server Migration Analysis\"\n</code></pre></p>"},{"location":"reference/cli/#conv-search","title":"/conv search","text":"<p>Search in conversation history.</p> <pre><code>/conv search &lt;query&gt;\n</code></pre> <p>Example: <pre><code>/conv search \"security issues\"\n/conv search \"nginx configuration\"\n</code></pre></p>"},{"location":"reference/cli/#conv-export","title":"/conv export","text":"<p>Export conversation to file.</p> <pre><code>/conv export &lt;id&gt; &lt;file&gt;\n</code></pre> <p>Supported Formats:</p> <ul> <li><code>.json</code> - JSON format</li> <li><code>.md</code> - Markdown format</li> </ul> <p>Example: <pre><code>/conv export abc12345 ~/my_conversation.md\n/conv export abc12345 ~/backup.json\n</code></pre></p>"},{"location":"reference/cli/#model-llm-management","title":"Model &amp; LLM Management","text":""},{"location":"reference/cli/#model-show","title":"/model show","text":"<p>Show current model configuration.</p> <pre><code>/model show\n</code></pre> <p>Displays:</p> <ul> <li>Provider name</li> <li>Model name</li> <li>API key status</li> <li>Router type</li> <li>Tier</li> <li>Fallback model</li> </ul>"},{"location":"reference/cli/#model-provider","title":"/model provider","text":"<p>Change LLM provider.</p> <pre><code>/model provider &lt;name&gt;\n</code></pre> <p>Available Providers:</p> Provider Description <code>openrouter</code> OpenRouter (100+ models, free tier available) <code>anthropic</code> Anthropic Claude models <code>openai</code> OpenAI GPT models <code>ollama</code> Ollama (local or cloud) <code>litellm</code> LiteLLM proxy <p>Prompts for API key if not configured.</p> <p>Example: <pre><code>/model provider openai\n/model provider openrouter\n</code></pre></p>"},{"location":"reference/cli/#model-model","title":"/model model","text":"<p>Change the LLM model.</p> <pre><code>/model model &lt;name&gt;\n</code></pre> <p>For Ollama, automatically detects cloud vs local endpoints.</p> <p>Examples: <pre><code>/model model gpt-4o\n/model model claude-3-5-sonnet-20241022\n/model model llama3.2\n</code></pre></p>"},{"location":"reference/cli/#model-test","title":"/model test","text":"<p>Test LLM connection.</p> <pre><code>/model test\n</code></pre> <p>Tests multiple model candidates and shows latency.</p>"},{"location":"reference/cli/#model-router","title":"/model router","text":"<p>Configure intent router.</p> <pre><code>/model router &lt;show|local|llm&gt;\n</code></pre> <p>Options:</p> Option Description <code>show</code> Show router configuration <code>local</code> Use local ONNX model for routing <code>llm &lt;model&gt;</code> Use LLM for intent routing <p>Examples: <pre><code>/model router show\n/model router local\n/model router llm gpt-3.5-turbo\n</code></pre></p>"},{"location":"reference/cli/#variable-management","title":"Variable Management","text":""},{"location":"reference/cli/#variable-list","title":"/variable list","text":"<p>List all variables.</p> <pre><code>/variable list\n</code></pre> <p>Aliases: <code>var</code></p> <p>Displays:</p> <ul> <li>Variable name</li> <li>Value (truncated)</li> <li>Type (regular or environment)</li> </ul>"},{"location":"reference/cli/#variable-set","title":"/variable set","text":"<p>Set a variable.</p> <pre><code>/variable set &lt;name&gt; &lt;value&gt; [--env]\n</code></pre> <p>Options:</p> <ul> <li><code>--env</code> - Mark as environment variable</li> </ul> <p>Examples: <pre><code>/variable set region eu-west-1\n/variable set api_url \"https://api.example.com\" --env\n</code></pre></p>"},{"location":"reference/cli/#variable-get","title":"/variable get","text":"<p>Get a variable value.</p> <pre><code>/variable get &lt;name&gt;\n</code></pre> <p>Example: <pre><code>/variable get region\n</code></pre></p>"},{"location":"reference/cli/#variable-delete","title":"/variable delete","text":"<p>Delete a variable.</p> <pre><code>/variable delete &lt;name&gt;\n</code></pre> <p>Example: <pre><code>/variable delete old_var\n</code></pre></p>"},{"location":"reference/cli/#secret-management","title":"Secret Management","text":"<p>Secrets are stored securely in the system keyring.</p>"},{"location":"reference/cli/#secret-list","title":"/secret list","text":"<p>List all secret names.</p> <pre><code>/secret list\n</code></pre> <p>Values are never displayed.</p>"},{"location":"reference/cli/#secret-set","title":"/secret set","text":"<p>Set a secret securely.</p> <pre><code>/secret set &lt;name&gt;\n</code></pre> <p>Uses secure input prompt (no echo).</p> <p>Example: <pre><code>/secret set my_api_key\n</code></pre></p>"},{"location":"reference/cli/#secret-delete","title":"/secret delete","text":"<p>Delete a secret.</p> <pre><code>/secret delete &lt;name&gt;\n</code></pre> <p>Example: <pre><code>/secret delete old_api_key\n</code></pre></p>"},{"location":"reference/cli/#mentions","title":"Mentions","text":"<p>You can mention entities in your chat messages:</p> Syntax Description <code>@hostname</code> Reference a host from inventory <code>@variable_name</code> Reference a variable value <code>@secret_name</code> Reference a secret (not logged) <p>Examples: <pre><code>Check disk usage on @web-prod-01\nDeploy to @staging using @deploy_key\nWhat's the status of @nodeapp on @server1\n</code></pre></p>"},{"location":"reference/cli/#autocompletion","title":"Autocompletion","text":"<p>The REPL supports Tab autocompletion for:</p> <ul> <li>Slash commands - Type <code>/</code> and press Tab</li> <li>Host mentions - Type <code>@</code> and press Tab</li> <li>Variable mentions - Type <code>@</code> and press Tab</li> <li>Command history - Use Up/Down arrows</li> </ul>"},{"location":"reference/cli/#exit-codes","title":"Exit Codes","text":"Code Meaning 0 Success 1 General error 2 Configuration error 3 Connection error 4 Authentication error 5 Command execution error 130 Interrupted (Ctrl+C)"},{"location":"reference/cli/#environment-variables","title":"Environment Variables","text":"Variable Description <code>ANTHROPIC_API_KEY</code> Anthropic API key <code>OPENAI_API_KEY</code> OpenAI API key <code>OPENROUTER_API_KEY</code> OpenRouter API key <code>MERLYA_ROUTER_FALLBACK</code> LLM fallback model <code>MERLYA_LOG_LEVEL</code> Log level (debug, info, warning, error) <code>MERLYA_CONFIG</code> Config file path <code>MERLYA_SSH_TIMEOUT</code> SSH connection timeout"},{"location":"reference/configuration/","title":"Configuration Reference","text":"<p>Complete reference for all configuration options.</p>"},{"location":"reference/configuration/#configuration-files","title":"Configuration Files","text":"File Purpose <code>~/.merlya/config.yaml</code> Main configuration <code>~/.merlya/merlya.db</code> Hosts inventory (SQLite) <code>~/.merlya/history</code> Command history <code>~/.merlya/logs/</code> Log files"},{"location":"reference/configuration/#general-settings","title":"General Settings","text":""},{"location":"reference/configuration/#generallanguage","title":"general.language","text":"<p>UI language.</p> Type Default Values string <code>en</code> <code>en</code>, <code>fr</code> <pre><code>general:\n  language: en\n</code></pre>"},{"location":"reference/configuration/#generallog_level","title":"general.log_level","text":"<p>Legacy Setting</p> <p>This setting is deprecated. Use <code>logging.console_level</code> instead. Kept for backwards compatibility as fallback.</p> Type Default Values string <code>info</code> <code>debug</code>, <code>info</code>, <code>warning</code>, <code>error</code> <pre><code>general:\n  log_level: info  # Deprecated, use logging.console_level\n</code></pre>"},{"location":"reference/configuration/#generaldata_dir","title":"general.data_dir","text":"<p>Data directory path.</p> Type Default string <code>~/.merlya</code> <pre><code>general:\n  data_dir: ~/.merlya\n</code></pre>"},{"location":"reference/configuration/#model-settings","title":"Model Settings","text":""},{"location":"reference/configuration/#modelprovider","title":"model.provider","text":"<p>LLM provider to use.</p> Type Default Values string <code>openrouter</code> <code>openrouter</code>, <code>anthropic</code>, <code>openai</code>, <code>ollama</code> <pre><code>model:\n  provider: openrouter\n</code></pre>"},{"location":"reference/configuration/#modelmodel","title":"model.model","text":"<p>Model name/identifier.</p> Type Default string <code>amazon/nova-2-lite-v1:free</code> <pre><code>model:\n  model: amazon/nova-2-lite-v1:free\n</code></pre> <p>Provider-specific examples:</p> Provider Example Model OpenRouter <code>amazon/nova-2-lite-v1:free</code>, <code>anthropic/claude-3.5-sonnet</code> Anthropic <code>claude-3-5-sonnet-latest</code>, <code>claude-3-5-haiku-latest</code> OpenAI <code>gpt-4o</code>, <code>gpt-4o-mini</code> Ollama <code>llama3.2</code>, <code>qwen2.5:7b</code>"},{"location":"reference/configuration/#modelapi_key_env","title":"model.api_key_env","text":"<p>Environment variable name for API key.</p> Type Default string (auto-detected) <pre><code>model:\n  api_key_env: OPENROUTER_API_KEY\n</code></pre> <p>API Key Storage</p> <p>API keys are stored securely in your system's keyring, not in config files. The <code>api_key_env</code> setting specifies which environment variable to check.</p>"},{"location":"reference/configuration/#modelbase_url","title":"model.base_url","text":"<p>Custom API endpoint URL (for Ollama or custom providers).</p> Type Default string Provider default <pre><code>model:\n  base_url: http://localhost:11434/v1\n</code></pre>"},{"location":"reference/configuration/#router-settings","title":"Router Settings","text":"<p>The router classifies user intent to determine appropriate actions.</p>"},{"location":"reference/configuration/#routertype","title":"router.type","text":"<p>Router type for intent classification.</p> Type Default Values string <code>local</code> <code>local</code>, <code>llm</code> <ul> <li><code>local</code>: Uses local ONNX embedding model (faster, offline)</li> <li><code>llm</code>: Uses LLM for classification (more accurate, requires API)</li> </ul> <pre><code>router:\n  type: local\n</code></pre>"},{"location":"reference/configuration/#routermodel","title":"router.model","text":"<p>Local embedding model ID (when <code>type: local</code>).</p> Type Default string (auto-selected by tier) <pre><code>router:\n  model: sentence-transformers/all-MiniLM-L6-v2\n</code></pre>"},{"location":"reference/configuration/#routertier","title":"router.tier","text":"<p>Model tier for local router.</p> Type Default Values string <code>balanced</code> <code>performance</code>, <code>balanced</code>, <code>lightweight</code> <pre><code>router:\n  tier: balanced\n</code></pre>"},{"location":"reference/configuration/#routerllm_fallback","title":"router.llm_fallback","text":"<p>LLM model for fallback classification.</p> Type Default string <code>openrouter:google/gemini-2.0-flash-lite-001</code> <pre><code>router:\n  llm_fallback: openrouter:google/gemini-2.0-flash-lite-001\n</code></pre>"},{"location":"reference/configuration/#ssh-settings","title":"SSH Settings","text":""},{"location":"reference/configuration/#sshconnect_timeout","title":"ssh.connect_timeout","text":"<p>Connection timeout in seconds.</p> Type Default Range integer <code>30</code> 5 - 120 <pre><code>ssh:\n  connect_timeout: 30\n</code></pre>"},{"location":"reference/configuration/#sshpool_timeout","title":"ssh.pool_timeout","text":"<p>Connection pool timeout in seconds.</p> Type Default Range integer <code>600</code> 60 - 3600 <pre><code>ssh:\n  pool_timeout: 600\n</code></pre>"},{"location":"reference/configuration/#sshcommand_timeout","title":"ssh.command_timeout","text":"<p>Command execution timeout in seconds.</p> Type Default Range integer <code>60</code> 5 - 3600 <pre><code>ssh:\n  command_timeout: 60\n</code></pre>"},{"location":"reference/configuration/#sshdefault_user","title":"ssh.default_user","text":"<p>Default SSH username.</p> Type Default string (none) <pre><code>ssh:\n  default_user: deploy\n</code></pre>"},{"location":"reference/configuration/#sshdefault_key","title":"ssh.default_key","text":"<p>Default SSH private key path.</p> Type Default string (none) <pre><code>ssh:\n  default_key: ~/.ssh/id_ed25519\n</code></pre>"},{"location":"reference/configuration/#ui-settings","title":"UI Settings","text":""},{"location":"reference/configuration/#uitheme","title":"ui.theme","text":"<p>Color theme.</p> Type Default Values string <code>auto</code> <code>auto</code>, <code>light</code>, <code>dark</code> <pre><code>ui:\n  theme: auto\n</code></pre>"},{"location":"reference/configuration/#uimarkdown","title":"ui.markdown","text":"<p>Enable markdown rendering in responses.</p> Type Default boolean <code>true</code> <pre><code>ui:\n  markdown: true\n</code></pre>"},{"location":"reference/configuration/#uisyntax_highlight","title":"ui.syntax_highlight","text":"<p>Enable syntax highlighting for code blocks.</p> Type Default boolean <code>true</code> <pre><code>ui:\n  syntax_highlight: true\n</code></pre>"},{"location":"reference/configuration/#logging-settings","title":"Logging Settings","text":""},{"location":"reference/configuration/#loggingconsole_level","title":"logging.console_level","text":"<p>Console log level for terminal output.</p> Type Default Values string <code>info</code> <code>debug</code>, <code>info</code>, <code>warning</code>, <code>error</code> <pre><code>logging:\n  console_level: info\n</code></pre> <p>CLI Flags</p> <p>Use <code>-v</code> or <code>--verbose</code> flag to override to <code>debug</code> level. Use <code>-q</code> or <code>--quiet</code> flag to suppress console logging.</p>"},{"location":"reference/configuration/#loggingfile_level","title":"logging.file_level","text":"<p>File log level.</p> Type Default Values string <code>debug</code> <code>debug</code>, <code>info</code>, <code>warning</code>, <code>error</code> <pre><code>logging:\n  file_level: debug\n</code></pre>"},{"location":"reference/configuration/#loggingmax_size_mb","title":"logging.max_size_mb","text":"<p>Maximum log file size in MB before rotation.</p> Type Default Range integer <code>10</code> 1 - 100 <pre><code>logging:\n  max_size_mb: 10\n</code></pre>"},{"location":"reference/configuration/#loggingmax_files","title":"logging.max_files","text":"<p>Maximum number of log files to keep.</p> Type Default Range integer <code>5</code> 1 - 20 <pre><code>logging:\n  max_files: 5\n</code></pre>"},{"location":"reference/configuration/#loggingretention_days","title":"logging.retention_days","text":"<p>Log retention in days.</p> Type Default Range integer <code>7</code> 1 - 90 <pre><code>logging:\n  retention_days: 7\n</code></pre>"},{"location":"reference/configuration/#hosts-configuration","title":"Hosts Configuration","text":"<p>Hosts are stored in a SQLite database and managed via the <code>/hosts</code> commands.</p>"},{"location":"reference/configuration/#host-properties","title":"Host Properties","text":"Property Type Required Description <code>name</code> string Yes Unique host identifier <code>hostname</code> string Yes Server hostname or IP <code>port</code> integer No SSH port (default: 22) <code>username</code> string No SSH username <code>private_key</code> string No SSH private key path <code>jump_host</code> string No Jump/bastion host name <code>tags</code> array No Tags for filtering"},{"location":"reference/configuration/#managing-hosts","title":"Managing Hosts","text":"<pre><code># Add a host\n/hosts add web-01\n\n# Import from SSH config\n/hosts import ~/.ssh/config --format=ssh\n\n# List hosts\n/hosts list\n\n# Show host details\n/hosts show web-01\n\n# Add tags\n/hosts tag web-01 production\n\n# Delete a host\n/hosts delete old-server\n</code></pre>"},{"location":"reference/configuration/#complete-example","title":"Complete Example","text":"<pre><code># ~/.merlya/config.yaml\n\ngeneral:\n  language: en\n\nmodel:\n  provider: openrouter\n  model: amazon/nova-2-lite-v1:free\n  api_key_env: OPENROUTER_API_KEY\n\nrouter:\n  type: local\n  tier: balanced\n  llm_fallback: openrouter:google/gemini-2.0-flash-lite-001\n\nssh:\n  connect_timeout: 30\n  pool_timeout: 600\n  command_timeout: 60\n  default_user: deploy\n  default_key: ~/.ssh/id_ed25519\n\nui:\n  theme: auto\n  markdown: true\n  syntax_highlight: true\n\nlogging:\n  console_level: info\n  file_level: debug\n  max_size_mb: 10\n  max_files: 5\n  retention_days: 7\n</code></pre>"},{"location":"reference/configuration/#environment-variables","title":"Environment Variables","text":"<p>Override settings with environment variables:</p> Variable Description <code>OPENROUTER_API_KEY</code> OpenRouter API key <code>ANTHROPIC_API_KEY</code> Anthropic API key <code>OPENAI_API_KEY</code> OpenAI API key <code>OLLAMA_API_KEY</code> Ollama cloud API key <code>MERLYA_LOG_LEVEL</code> Override log level <code>MERLYA_ROUTER_FALLBACK</code> Override router fallback model <code>MERLYA_ROUTER_MODEL</code> Override local router model"},{"location":"reference/non-interactive/","title":"Non-Interactive Mode Reference","text":"<p>Complete reference for Merlya's non-interactive (batch) execution mode.</p>"},{"location":"reference/non-interactive/#overview","title":"Overview","text":"<p>Non-interactive mode (<code>merlya run</code>) executes commands without user interaction, making it ideal for:</p> <ul> <li>CI/CD pipelines (GitHub Actions, GitLab CI, Jenkins)</li> <li>Scheduled tasks (cron, systemd timers)</li> <li>Shell scripts and automation</li> <li>Docker containers</li> <li>Monitoring and alerting</li> </ul>"},{"location":"reference/non-interactive/#command-syntax","title":"Command Syntax","text":"<pre><code>merlya run [OPTIONS] [COMMAND]\n</code></pre>"},{"location":"reference/non-interactive/#arguments","title":"Arguments","text":"Argument Description <code>COMMAND</code> Natural language command to execute"},{"location":"reference/non-interactive/#options","title":"Options","text":"Option Short Description <code>--file FILE</code> <code>-f</code> Load tasks from YAML or text file <code>--yes</code> <code>-y</code> Skip confirmation prompts (auto-confirm) <code>--format FORMAT</code> Output format: <code>text</code> (default) or <code>json</code> <code>--quiet</code> <code>-q</code> Minimal output (errors only) <code>--verbose</code> <code>-v</code> Enable verbose logging <code>--help</code> Show help message"},{"location":"reference/non-interactive/#single-command-execution","title":"Single Command Execution","text":"<p>Execute a single command:</p> <pre><code>merlya run \"Check disk space on all web servers\"\n</code></pre> <p>With auto-confirmation (required for commands that modify systems):</p> <pre><code>merlya run --yes \"Restart nginx on @web-01\"\n</code></pre>"},{"location":"reference/non-interactive/#task-file-execution","title":"Task File Execution","text":"<p>Execute multiple tasks from a file:</p> <pre><code>merlya run --file tasks.yml\n</code></pre>"},{"location":"reference/non-interactive/#yaml-format","title":"YAML Format","text":"<pre><code># tasks.yml\ntasks:\n  - description: \"Check disk space\"\n    prompt: \"Check disk usage on all servers, warn if above 80%\"\n\n  - description: \"Check memory\"\n    prompt: \"Check memory usage on all servers\"\n\n  - prompt: \"Verify nginx is running on web tier\"\n</code></pre> <p>Fields:</p> Field Required Description <code>prompt</code> Yes The natural language command <code>description</code> No Human-readable task description"},{"location":"reference/non-interactive/#text-format","title":"Text Format","text":"<p>Simple one-command-per-line format:</p> <pre><code># tasks.txt\nCheck disk space on all servers\nList running services\nVerify backup status from last 24h\n</code></pre> <p>Lines starting with <code>#</code> are treated as comments.</p>"},{"location":"reference/non-interactive/#output-formats","title":"Output Formats","text":""},{"location":"reference/non-interactive/#text-output-default","title":"Text Output (Default)","text":"<p>Human-readable output:</p> <pre><code>merlya run \"Check uptime on @web-01\"\n</code></pre> <pre><code>Running health checks...\nExecuting: Check uptime on @web-01\n\n&gt; ssh web-01 \"uptime\"\n 14:32:01 up 45 days,  3:21,  2 users,  load average: 0.15, 0.10, 0.05\n\nThe server has been running for 45 days with low load average.\n\nCompleted: 1/1 tasks passed\n</code></pre>"},{"location":"reference/non-interactive/#json-output","title":"JSON Output","text":"<p>Machine-parseable output for automation:</p> <pre><code>merlya run --format json \"Check uptime on @web-01\"\n</code></pre> <pre><code>{\n  \"success\": true,\n  \"total\": 1,\n  \"passed\": 1,\n  \"failed\": 0,\n  \"tasks\": [\n    {\n      \"task\": \"Check uptime on @web-01\",\n      \"success\": true,\n      \"message\": \"The server has been running for 45 days with low load average.\",\n      \"actions\": [\"ssh_execute\"]\n    }\n  ]\n}\n</code></pre>"},{"location":"reference/non-interactive/#quiet-mode","title":"Quiet Mode","text":"<p>Only errors are displayed:</p> <pre><code>merlya run --quiet --yes \"Check server health\"\n</code></pre>"},{"location":"reference/non-interactive/#exit-codes","title":"Exit Codes","text":"Code Meaning 0 All tasks succeeded 1 One or more tasks failed 2 Configuration error 3 File not found <p>Use exit codes in scripts:</p> <pre><code>#!/bin/bash\nif merlya run --quiet --yes \"Check all servers healthy\"; then\n    echo \"All systems operational\"\nelse\n    echo \"Issues detected!\"\n    exit 1\nfi\n</code></pre>"},{"location":"reference/non-interactive/#environment-variables","title":"Environment Variables","text":"<p>Configure Merlya via environment variables (useful in containers):</p> Variable Description <code>OPENROUTER_API_KEY</code> OpenRouter API key <code>ANTHROPIC_API_KEY</code> Anthropic API key <code>OPENAI_API_KEY</code> OpenAI API key <code>MERLYA_LOG_LEVEL</code> Log level (debug, info, warning, error) <code>MERLYA_ROUTER_FALLBACK</code> LLM fallback model <p>Example:</p> <pre><code>OPENROUTER_API_KEY=or-xxx merlya run \"Check disk space\"\n</code></pre>"},{"location":"reference/non-interactive/#use-cases","title":"Use Cases","text":""},{"location":"reference/non-interactive/#cron-job","title":"Cron Job","text":"<pre><code># /etc/cron.d/merlya-health\n0 6 * * * root /usr/local/bin/merlya run --format json --yes \\\n    \"Run daily health checks\" &gt;&gt; /var/log/merlya/daily.log 2&gt;&amp;1\n</code></pre>"},{"location":"reference/non-interactive/#shell-script","title":"Shell Script","text":"<pre><code>#!/bin/bash\nset -e\n\nLOG_FILE=\"/var/log/merlya/deploy.log\"\n\necho \"$(date): Starting deployment\" &gt;&gt; $LOG_FILE\n\n# Pre-flight checks\nRESULT=$(merlya run --format json --yes \"Verify all servers healthy\")\n\nif echo \"$RESULT\" | jq -e '.success' &gt; /dev/null; then\n    echo \"$(date): Pre-flight passed\" &gt;&gt; $LOG_FILE\n    merlya run --yes \"Deploy version $VERSION to production\"\nelse\n    echo \"$(date): Pre-flight FAILED\" &gt;&gt; $LOG_FILE\n    exit 1\nfi\n</code></pre>"},{"location":"reference/non-interactive/#github-actions","title":"GitHub Actions","text":"<pre><code>- name: Health Check\n  env:\n    OPENROUTER_API_KEY: ${{ secrets.OPENROUTER_API_KEY }}\n  run: |\n    pip install merlya\n    merlya run --format json --yes \"Check all production servers\"\n</code></pre>"},{"location":"reference/non-interactive/#docker","title":"Docker","text":"<pre><code>docker run -e OPENROUTER_API_KEY=or-xxx merlya:latest \\\n    run --yes --format json \"Check disk space\"\n</code></pre>"},{"location":"reference/non-interactive/#best-practices","title":"Best Practices","text":"<ol> <li>Always use <code>--yes</code> in automation - Prompts will hang without TTY</li> <li>Use <code>--format json</code> for parsing - Reliable structured output</li> <li>Check exit codes - Handle failures gracefully</li> <li>Log output - Keep records of automated actions</li> <li>Test in staging first - Before automating production tasks</li> <li>Set timeouts - Wrap long-running commands with <code>timeout</code></li> </ol> <pre><code># Example with timeout\ntimeout 300 merlya run --yes \"Deploy to production\" || {\n    echo \"Deployment timed out after 5 minutes\"\n    exit 1\n}\n</code></pre>"},{"location":"reference/non-interactive/#troubleshooting","title":"Troubleshooting","text":""},{"location":"reference/non-interactive/#health-checks-failed","title":"\"Health checks failed\"","text":"<p>The LLM provider is not configured or unreachable:</p> <pre><code># Check configuration\nmerlya config show\n\n# Set API key\nexport OPENROUTER_API_KEY=or-xxx\n</code></pre>"},{"location":"reference/non-interactive/#host-not-found","title":"\"Host not found\"","text":"<p>The target host is not in the inventory:</p> <pre><code># List available hosts\nmerlya run \"List all hosts\"\n\n# Or add the host first (interactive mode)\nmerlya\n/hosts add web-01\n</code></pre>"},{"location":"reference/non-interactive/#no-output-in-json-mode","title":"No output in JSON mode","text":"<p>Ensure you're capturing both stdout and stderr:</p> <pre><code>RESULT=$(merlya run --format json \"...\" 2&gt;&amp;1)\n</code></pre>"}]}